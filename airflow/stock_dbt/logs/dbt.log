[0m13:04:18.417837 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6b765836b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6b7619f2f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6b76581a60>]}


============================== 13:04:18.422461 | a9ac0972-eeba-40a1-8ecb-42c394a040b0 ==============================
[0m13:04:18.422461 [info ] [MainThread]: Running with dbt=1.8.9
[0m13:04:18.423004 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/woong/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt/stock_elt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt debug', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:04:18.447882 [info ] [MainThread]: dbt version: 1.8.9
[0m13:04:18.448374 [info ] [MainThread]: python version: 3.12.3
[0m13:04:18.448759 [info ] [MainThread]: python path: /home/woong/de4_week3/myvenv/bin/python3
[0m13:04:18.449105 [info ] [MainThread]: os info: Linux-5.15.153.1-microsoft-standard-WSL2-x86_64-with-glibc2.39
[0m13:04:18.861193 [info ] [MainThread]: Using profiles dir at /home/woong/.dbt
[0m13:04:18.861856 [info ] [MainThread]: Using profiles.yml file at /home/woong/.dbt/profiles.yml
[0m13:04:18.862234 [info ] [MainThread]: Using dbt_project.yml file at /home/woong/de4_week3/stock-watcher/airflow/stock_dbt/stock_elt/dbt_project.yml
[0m13:04:18.863711 [info ] [MainThread]: adapter type: snowflake
[0m13:04:18.864301 [info ] [MainThread]: adapter version: 1.8.4
[0m13:04:18.941433 [info ] [MainThread]: Configuration:
[0m13:04:18.942751 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m13:04:18.944120 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m13:04:18.944912 [info ] [MainThread]: Required dependencies:
[0m13:04:18.945349 [debug] [MainThread]: Executing "git --help"
[0m13:04:18.947754 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--config-env=<name>=<envvar>] <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m13:04:18.948175 [debug] [MainThread]: STDERR: "b''"
[0m13:04:18.948425 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m13:04:18.948766 [info ] [MainThread]: Connection:
[0m13:04:18.949075 [info ] [MainThread]:   account: zofygnx-mgb31072
[0m13:04:18.949316 [info ] [MainThread]:   user: JM
[0m13:04:18.949548 [info ] [MainThread]:   database: Stock_Watcher
[0m13:04:18.949779 [info ] [MainThread]:   warehouse: compute_wh
[0m13:04:18.949998 [info ] [MainThread]:   role: ACCOUNTADMIN
[0m13:04:18.950217 [info ] [MainThread]:   schema: raw_data
[0m13:04:18.950447 [info ] [MainThread]:   authenticator: None
[0m13:04:18.950673 [info ] [MainThread]:   oauth_client_id: None
[0m13:04:18.950906 [info ] [MainThread]:   query_tag: None
[0m13:04:18.951112 [info ] [MainThread]:   client_session_keep_alive: False
[0m13:04:18.951330 [info ] [MainThread]:   host: None
[0m13:04:18.951541 [info ] [MainThread]:   port: None
[0m13:04:18.951760 [info ] [MainThread]:   proxy_host: None
[0m13:04:18.951967 [info ] [MainThread]:   proxy_port: None
[0m13:04:18.952171 [info ] [MainThread]:   protocol: None
[0m13:04:18.952380 [info ] [MainThread]:   connect_retries: 1
[0m13:04:18.952621 [info ] [MainThread]:   connect_timeout: None
[0m13:04:18.952923 [info ] [MainThread]:   retry_on_database_errors: False
[0m13:04:18.953153 [info ] [MainThread]:   retry_all: False
[0m13:04:18.953364 [info ] [MainThread]:   insecure_mode: False
[0m13:04:18.953571 [info ] [MainThread]:   reuse_connections: None
[0m13:04:18.953940 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m13:04:19.009689 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m13:04:19.010541 [debug] [MainThread]: Using snowflake connection "debug"
[0m13:04:19.010827 [debug] [MainThread]: On debug: select 1 as id
[0m13:04:19.011042 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:04:20.208409 [debug] [MainThread]: SQL status: SUCCESS 1 in 1.197 seconds
[0m13:04:20.211644 [debug] [MainThread]: On debug: Close
[0m13:04:20.553872 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m13:04:20.554368 [info ] [MainThread]: [32mAll checks passed![0m
[0m13:04:20.559148 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 2.1874063, "process_in_blocks": "87576", "process_kernel_time": 0.202495, "process_mem_max_rss": "117772", "process_out_blocks": "24", "process_user_time": 1.57394}
[0m13:04:20.559676 [debug] [MainThread]: Command `dbt debug` succeeded at 13:04:20.559585 after 2.19 seconds
[0m13:04:20.559966 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m13:04:20.560227 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6b7619f2f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6b75a0f890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6b746c7590>]}
[0m13:04:20.560489 [debug] [MainThread]: Flushing usage events
[0m14:43:30.374410 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9524d58e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9525bcbf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd95248d0d0>]}


============================== 14:43:30.395262 | 1c902fb8-39c4-4446-96ee-4ecc6c110fd2 ==============================
[0m14:43:30.395262 [info ] [MainThread]: Running with dbt=1.8.9
[0m14:43:30.395752 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt/stock_elt/logs', 'profiles_dir': '/home/woong/.dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:43:31.294477 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1c902fb8-39c4-4446-96ee-4ecc6c110fd2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9513895b0>]}
[0m14:43:31.343901 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1c902fb8-39c4-4446-96ee-4ecc6c110fd2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd953299be0>]}
[0m14:43:31.345034 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m14:43:31.460186 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m14:43:31.461165 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m14:43:31.461562 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '1c902fb8-39c4-4446-96ee-4ecc6c110fd2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd952d97560>]}
[0m14:43:31.467296 [error] [MainThread]: Encountered an error:
Parsing Error
  Error reading stock_elt: sources.yml - Runtime Error
    Syntax error near line 4
    ------------------------------
    1  | version 2
    2  | 
    3  | 
    4  | sources:
    5  |   -name: raw
    6  |    schema: raw_data
    7  |    tables:
    
    Raw Error:
    ------------------------------
    mapping values are not allowed in this context
      in "<unicode string>", line 4, column 8
[0m14:43:31.469530 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.1526309, "process_in_blocks": "83824", "process_kernel_time": 1.193567, "process_mem_max_rss": "110780", "process_out_blocks": "16", "process_user_time": 2.047502}
[0m14:43:31.470034 [debug] [MainThread]: Command `dbt run` failed at 14:43:31.469940 after 1.15 seconds
[0m14:43:31.470399 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9526453a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd951007fb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd950ec09e0>]}
[0m14:43:31.470670 [debug] [MainThread]: Flushing usage events
[0m14:58:02.867652 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc02f653e90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc02fc05010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc02f48d160>]}


============================== 14:58:02.889573 | ad5275cd-c313-401e-8869-6cb0d41f15d4 ==============================
[0m14:58:02.889573 [info ] [MainThread]: Running with dbt=1.8.9
[0m14:58:02.890546 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/woong/.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt/stock_elt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:58:04.188629 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ad5275cd-c313-401e-8869-6cb0d41f15d4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc02ec894f0>]}
[0m14:58:04.261469 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ad5275cd-c313-401e-8869-6cb0d41f15d4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc02ec89be0>]}
[0m14:58:04.264365 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m14:58:04.387884 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m14:58:04.389291 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m14:58:04.390100 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'ad5275cd-c313-401e-8869-6cb0d41f15d4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc02d57bd70>]}
[0m14:58:04.404433 [error] [MainThread]: Encountered an error:
Parsing Error
  Error reading stock_elt: sources.yml - Runtime Error
    Syntax error near line 4
    ------------------------------
    1  | version 2
    2  | 
    3  | 
    4  | sources:
    5  |   -name: raw
    6  |    schema: raw_data
    7  |    tables:
    
    Raw Error:
    ------------------------------
    mapping values are not allowed in this context
      in "<unicode string>", line 4, column 8
[0m14:58:04.406989 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.6169696, "process_in_blocks": "81392", "process_kernel_time": 1.657379, "process_mem_max_rss": "110940", "process_out_blocks": "16", "process_user_time": 2.890777}
[0m14:58:04.407696 [debug] [MainThread]: Command `dbt run` failed at 14:58:04.407566 after 1.62 seconds
[0m14:58:04.408200 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc03225b350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc02d57b5c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc02f096d80>]}
[0m14:58:04.408699 [debug] [MainThread]: Flushing usage events
[0m15:01:28.167469 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f86729e7770>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8672f78920>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8674ab1b20>]}


============================== 15:01:28.177407 | 560bfd0e-37cf-49f0-aa47-cbe6c67232ad ==============================
[0m15:01:28.177407 [info ] [MainThread]: Running with dbt=1.8.9
[0m15:01:28.178732 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt/stock_elt/logs', 'profiles_dir': '/home/woong/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:01:29.364985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '560bfd0e-37cf-49f0-aa47-cbe6c67232ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8671199ee0>]}
[0m15:01:29.478532 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '560bfd0e-37cf-49f0-aa47-cbe6c67232ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8670ebe870>]}
[0m15:01:29.480369 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m15:01:29.654800 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m15:01:29.656303 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m15:01:29.659532 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '560bfd0e-37cf-49f0-aa47-cbe6c67232ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8670e66d80>]}
[0m15:01:29.674377 [error] [MainThread]: Encountered an error:
Parsing Error
  Error reading stock_elt: sources.yml - Runtime Error
    Syntax error near line 6
    ------------------------------
    3  | 
    4  | sources:
    5  |   -name: raw
    6  |    schema: raw_data
    7  |    tables:
    8  |      -name: fs_st_if_cpl
    9  |       identifier: foreign_stock_info_complete
    
    Raw Error:
    ------------------------------
    mapping values are not allowed in this context
      in "<unicode string>", line 6, column 10
[0m15:01:29.677541 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.624431, "process_in_blocks": "80664", "process_kernel_time": 0.509671, "process_mem_max_rss": "110912", "process_out_blocks": "16", "process_user_time": 3.683096}
[0m15:01:29.678789 [debug] [MainThread]: Command `dbt run` failed at 15:01:29.678555 after 1.63 seconds
[0m15:01:29.679432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f86735ed9a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8672f7b230>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8670e58cb0>]}
[0m15:01:29.680142 [debug] [MainThread]: Flushing usage events
[0m15:05:02.619354 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd7e3512540>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd7e2c29910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd7e37ba000>]}


============================== 15:05:02.626831 | 313722fa-ee59-4d2d-a904-be015b08f6c5 ==============================
[0m15:05:02.626831 [info ] [MainThread]: Running with dbt=1.8.9
[0m15:05:02.627572 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/woong/.dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt/stock_elt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:05:03.508089 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '313722fa-ee59-4d2d-a904-be015b08f6c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd7e15398e0>]}
[0m15:05:03.584373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '313722fa-ee59-4d2d-a904-be015b08f6c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd7e19a6510>]}
[0m15:05:03.587586 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m15:05:03.711820 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m15:05:03.712839 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m15:05:03.713395 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '313722fa-ee59-4d2d-a904-be015b08f6c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd7e183dbb0>]}
[0m15:05:05.324727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '313722fa-ee59-4d2d-a904-be015b08f6c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd7e11f84d0>]}
[0m15:05:05.456395 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '313722fa-ee59-4d2d-a904-be015b08f6c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd7e2af9be0>]}
[0m15:05:05.457272 [info ] [MainThread]: Found 2 models, 1 source, 459 macros
[0m15:05:05.457853 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '313722fa-ee59-4d2d-a904-be015b08f6c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd7e2b18710>]}
[0m15:05:05.461963 [info ] [MainThread]: 
[0m15:05:05.462966 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:05:05.466009 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_Stock_Watcher'
[0m15:05:05.488283 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher"
[0m15:05:05.488927 [debug] [ThreadPool]: On list_Stock_Watcher: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "list_Stock_Watcher"} */
show terse schemas in database Stock_Watcher
    limit 10000
[0m15:05:05.489287 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:05:06.994281 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 1.505 seconds
[0m15:05:06.996575 [debug] [ThreadPool]: On list_Stock_Watcher: Close
[0m15:05:07.380551 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_Stock_Watcher_raw_data'
[0m15:05:07.398266 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher_raw_data"
[0m15:05:07.398874 [debug] [ThreadPool]: On list_Stock_Watcher_raw_data: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "list_Stock_Watcher_raw_data"} */
show objects in Stock_Watcher.raw_data limit 10000
[0m15:05:07.399235 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:05:08.521576 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 1.122 seconds
[0m15:05:08.524641 [debug] [ThreadPool]: On list_Stock_Watcher_raw_data: Close
[0m15:05:08.916256 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '313722fa-ee59-4d2d-a904-be015b08f6c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd7e1120770>]}
[0m15:05:08.917080 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:05:08.917665 [info ] [MainThread]: 
[0m15:05:08.926090 [debug] [Thread-1 (]: Began running node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m15:05:08.926751 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_Stock_Watcher_raw_data, now model.stock_elt.src_foreign_stock_change_rate_conditions)
[0m15:05:08.927175 [debug] [Thread-1 (]: Began compiling node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m15:05:08.939587 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_elt.src_foreign_stock_change_rate_conditions"
[0m15:05:08.946329 [debug] [Thread-1 (]: Finished running node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m15:05:08.949443 [debug] [Thread-1 (]: Began running node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:05:08.950708 [info ] [Thread-1 (]: 1 of 1 START sql table model raw_data.foreign_stock_change_rate_conditions ..... [RUN]
[0m15:05:08.951898 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.stock_elt.src_foreign_stock_change_rate_conditions, now model.stock_elt.foreign_stock_change_rate_conditions)
[0m15:05:08.952569 [debug] [Thread-1 (]: Began compiling node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:05:09.018885 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_elt.foreign_stock_change_rate_conditions"
[0m15:05:09.024258 [debug] [Thread-1 (]: Began executing node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:05:09.066578 [debug] [Thread-1 (]: Writing runtime sql for node "model.stock_elt.foreign_stock_change_rate_conditions"
[0m15:05:09.076438 [debug] [Thread-1 (]: Using snowflake connection "model.stock_elt.foreign_stock_change_rate_conditions"
[0m15:05:09.077803 [debug] [Thread-1 (]: On model.stock_elt.foreign_stock_change_rate_conditions: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "node_id": "model.stock_elt.foreign_stock_change_rate_conditions"} */
create or replace transient table Stock_Watcher.raw_data.foreign_stock_change_rate_conditions
         as
        (WITH  __dbt__cte__src_foreign_stock_change_rate_conditions as (
WITH src_foreign_stock_info_complete AS ( 
 SELECT * FROM Stock_Watcher.raw_data.foreign_stock_info_complete
)
SELECT NAME
     , FULLNAME 
     , DATE 
     , "Close" 
 FROM src_foreign_stock_info_complete
), ranked_data AS (
    SELECT *,
        ("Close" - LAG("Close") OVER (PARTITION BY name, fullname ORDER BY date)) / LAG("Close") OVER (PARTITION BY name, fullname ORDER BY date) * 100 AS change,
       -- 한 시간 변화율 계산
        (LEAD("Close", 1) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS hour_change,
        -- 하루 변화율 계산
        (LEAD("Close", 9) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS i_day_change_mean,
        
        -- 3일 변화율 계산
        (LEAD("Close", 27) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS three_day_change,
        
        -- 일주일 변화율 계산
        (LEAD("Close", 45) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS weekly_change
    FROM __dbt__cte__src_foreign_stock_change_rate_conditions
),
aggregated_data AS (
    SELECT
        CASE
            WHEN change > 10 THEN 'Change > 10'
            WHEN change > 5 THEN 'Change > 5'
            WHEN change <= -10 THEN 'Change <= -10'
            WHEN change <= -5 THEN 'Change <= -5'
            ELSE 'Other'
        END AS condition,
        AVG(hour_change) AS hour_change_mean,
        AVG(i_day_change_mean) AS i_day_change_mean,
        AVG(three_day_change) AS three_day_change_mean,
        AVG(weekly_change) AS weekly_change_mean,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY hour_change) AS hour_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY i_day_change_mean) AS i_day_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY three_day_change) AS three_day_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY weekly_change) AS weekly_change_median
    FROM ranked_data
    WHERE change > 5 OR change <= -5
    GROUP BY condition
)

-- mean값
SELECT 
    'hour_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN hour_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN hour_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN hour_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN hour_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'i_day_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN i_day_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN i_day_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN i_day_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN i_day_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'three_day_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN three_day_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN three_day_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN three_day_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN three_day_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'weekly_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN weekly_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN weekly_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN weekly_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN weekly_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

-- median값
UNION ALL

SELECT 
    'hour_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN hour_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN hour_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN hour_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN hour_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'i_day_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN i_day_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN i_day_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN i_day_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN i_day_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'three_day_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN three_day_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN three_day_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN three_day_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN three_day_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'weekly_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN weekly_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN weekly_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN weekly_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN weekly_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric
        );
[0m15:05:09.078830 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:05:11.471028 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.392 seconds
[0m15:05:11.510380 [debug] [Thread-1 (]: On model.stock_elt.foreign_stock_change_rate_conditions: Close
[0m15:05:11.902347 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '313722fa-ee59-4d2d-a904-be015b08f6c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd7e168ca40>]}
[0m15:05:11.903372 [info ] [Thread-1 (]: 1 of 1 OK created sql table model raw_data.foreign_stock_change_rate_conditions  [[32mSUCCESS 1[0m in 2.95s]
[0m15:05:11.904369 [debug] [Thread-1 (]: Finished running node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:05:11.907860 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:05:11.908502 [debug] [MainThread]: Connection 'list_Stock_Watcher' was properly closed.
[0m15:05:11.908853 [debug] [MainThread]: Connection 'model.stock_elt.foreign_stock_change_rate_conditions' was properly closed.
[0m15:05:11.909290 [info ] [MainThread]: 
[0m15:05:11.909762 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 6.45 seconds (6.45s).
[0m15:05:11.910735 [debug] [MainThread]: Command end result
[0m15:05:11.942169 [info ] [MainThread]: 
[0m15:05:11.943473 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:05:11.944220 [info ] [MainThread]: 
[0m15:05:11.945127 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m15:05:11.948828 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 9.398264, "process_in_blocks": "91176", "process_kernel_time": 0.591924, "process_mem_max_rss": "127720", "process_out_blocks": "2904", "process_user_time": 4.199848}
[0m15:05:11.949510 [debug] [MainThread]: Command `dbt run` succeeded at 15:05:11.949338 after 9.40 seconds
[0m15:05:11.949929 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd7e2d9b500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd7d3614c20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd7e2f93860>]}
[0m15:05:11.950515 [debug] [MainThread]: Flushing usage events
[0m15:23:56.068174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fa9635f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fa9d240b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fa8e64e60>]}


============================== 15:23:56.089327 | 155a8d11-0243-49e5-8bb5-32d8994ab93a ==============================
[0m15:23:56.089327 [info ] [MainThread]: Running with dbt=1.8.9
[0m15:23:56.090506 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/woong/.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt/stock_elt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:23:57.367631 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '155a8d11-0243-49e5-8bb5-32d8994ab93a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fa88b8ad0>]}
[0m15:23:57.447329 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '155a8d11-0243-49e5-8bb5-32d8994ab93a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fa789d6a0>]}
[0m15:23:57.450152 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m15:23:57.871685 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m15:23:58.084441 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m15:23:58.085422 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '155a8d11-0243-49e5-8bb5-32d8994ab93a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fa8eefb60>]}
[0m15:23:59.459961 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '155a8d11-0243-49e5-8bb5-32d8994ab93a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fa724e420>]}
[0m15:23:59.586495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '155a8d11-0243-49e5-8bb5-32d8994ab93a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fa8c72660>]}
[0m15:23:59.587122 [info ] [MainThread]: Found 2 models, 1 source, 459 macros
[0m15:23:59.587573 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '155a8d11-0243-49e5-8bb5-32d8994ab93a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fa724f2f0>]}
[0m15:23:59.590351 [info ] [MainThread]: 
[0m15:23:59.591301 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:23:59.593526 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_Stock_Watcher'
[0m15:23:59.622995 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher"
[0m15:23:59.623491 [debug] [ThreadPool]: On list_Stock_Watcher: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "list_Stock_Watcher"} */
show terse schemas in database Stock_Watcher
    limit 10000
[0m15:23:59.623845 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:24:01.159646 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 1.536 seconds
[0m15:24:01.163016 [debug] [ThreadPool]: On list_Stock_Watcher: Close
[0m15:24:01.479248 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_Stock_Watcher, now create_Stock_Watcher_raw_data_analytics)
[0m15:24:01.480963 [debug] [ThreadPool]: Creating schema "database: "Stock_Watcher"
schema: "raw_data_analytics"
"
[0m15:24:01.489530 [debug] [ThreadPool]: Using snowflake connection "create_Stock_Watcher_raw_data_analytics"
[0m15:24:01.490608 [debug] [ThreadPool]: On create_Stock_Watcher_raw_data_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "create_Stock_Watcher_raw_data_analytics"} */
create schema if not exists Stock_Watcher.raw_data_analytics
[0m15:24:01.491315 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:24:02.981858 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.491 seconds
[0m15:24:02.983460 [debug] [ThreadPool]: On create_Stock_Watcher_raw_data_analytics: Close
[0m15:24:03.413977 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_Stock_Watcher_raw_data_analytics, now list_Stock_Watcher_raw_data_analytics)
[0m15:24:03.424616 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher_raw_data_analytics"
[0m15:24:03.425371 [debug] [ThreadPool]: On list_Stock_Watcher_raw_data_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "list_Stock_Watcher_raw_data_analytics"} */
show objects in Stock_Watcher.raw_data_analytics limit 10000
[0m15:24:03.425913 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:24:04.430589 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 1.005 seconds
[0m15:24:04.432557 [debug] [ThreadPool]: On list_Stock_Watcher_raw_data_analytics: Close
[0m15:24:04.769710 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '155a8d11-0243-49e5-8bb5-32d8994ab93a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fa5a5dcd0>]}
[0m15:24:04.770658 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:24:04.771196 [info ] [MainThread]: 
[0m15:24:04.779201 [debug] [Thread-1 (]: Began running node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m15:24:04.779824 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_Stock_Watcher_raw_data_analytics, now model.stock_elt.src_foreign_stock_change_rate_conditions)
[0m15:24:04.780276 [debug] [Thread-1 (]: Began compiling node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m15:24:04.794204 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_elt.src_foreign_stock_change_rate_conditions"
[0m15:24:04.795808 [debug] [Thread-1 (]: Finished running node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m15:24:04.797276 [debug] [Thread-1 (]: Began running node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:24:04.798124 [info ] [Thread-1 (]: 1 of 1 START sql table model raw_data_analytics.foreign_stock_change_rate_conditions  [RUN]
[0m15:24:04.799162 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.stock_elt.src_foreign_stock_change_rate_conditions, now model.stock_elt.foreign_stock_change_rate_conditions)
[0m15:24:04.800059 [debug] [Thread-1 (]: Began compiling node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:24:04.868008 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_elt.foreign_stock_change_rate_conditions"
[0m15:24:04.868932 [debug] [Thread-1 (]: Began executing node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:24:04.913987 [debug] [Thread-1 (]: Writing runtime sql for node "model.stock_elt.foreign_stock_change_rate_conditions"
[0m15:24:04.923509 [debug] [Thread-1 (]: Using snowflake connection "model.stock_elt.foreign_stock_change_rate_conditions"
[0m15:24:04.924838 [debug] [Thread-1 (]: On model.stock_elt.foreign_stock_change_rate_conditions: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "node_id": "model.stock_elt.foreign_stock_change_rate_conditions"} */
create or replace transient table Stock_Watcher.raw_data_analytics.foreign_stock_change_rate_conditions
         as
        (WITH  __dbt__cte__src_foreign_stock_change_rate_conditions as (
WITH src_foreign_stock_info_complete AS ( 
 SELECT * FROM Stock_Watcher.raw_data.foreign_stock_info_complete
)
SELECT NAME
     , FULLNAME 
     , DATE 
     , "Close" 
 FROM src_foreign_stock_info_complete
), ranked_data AS (
    SELECT *,
        ("Close" - LAG("Close") OVER (PARTITION BY name, fullname ORDER BY date)) / LAG("Close") OVER (PARTITION BY name, fullname ORDER BY date) * 100 AS change,
       -- 한 시간 변화율 계산
        (LEAD("Close", 1) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS hour_change,
        -- 하루 변화율 계산
        (LEAD("Close", 9) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS i_day_change_mean,
        
        -- 3일 변화율 계산
        (LEAD("Close", 27) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS three_day_change,
        
        -- 일주일 변화율 계산
        (LEAD("Close", 45) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS weekly_change
    FROM __dbt__cte__src_foreign_stock_change_rate_conditions
),
aggregated_data AS (
    SELECT
        CASE
            WHEN change > 10 THEN 'Change > 10'
            WHEN change > 5 THEN 'Change > 5'
            WHEN change <= -10 THEN 'Change <= -10'
            WHEN change <= -5 THEN 'Change <= -5'
            ELSE 'Other'
        END AS condition,
        AVG(hour_change) AS hour_change_mean,
        AVG(i_day_change_mean) AS i_day_change_mean,
        AVG(three_day_change) AS three_day_change_mean,
        AVG(weekly_change) AS weekly_change_mean,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY hour_change) AS hour_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY i_day_change_mean) AS i_day_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY three_day_change) AS three_day_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY weekly_change) AS weekly_change_median
    FROM ranked_data
    WHERE change > 5 OR change <= -5
    GROUP BY condition
)

-- mean값
SELECT 
    'hour_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN hour_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN hour_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN hour_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN hour_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'i_day_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN i_day_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN i_day_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN i_day_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN i_day_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'three_day_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN three_day_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN three_day_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN three_day_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN three_day_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'weekly_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN weekly_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN weekly_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN weekly_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN weekly_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

-- median값
UNION ALL

SELECT 
    'hour_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN hour_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN hour_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN hour_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN hour_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'i_day_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN i_day_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN i_day_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN i_day_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN i_day_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'three_day_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN three_day_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN three_day_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN three_day_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN three_day_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'weekly_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN weekly_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN weekly_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN weekly_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN weekly_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric
        );
[0m15:24:04.925859 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:24:07.284543 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.358 seconds
[0m15:24:07.320661 [debug] [Thread-1 (]: On model.stock_elt.foreign_stock_change_rate_conditions: Close
[0m15:24:07.718365 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '155a8d11-0243-49e5-8bb5-32d8994ab93a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fa77e09b0>]}
[0m15:24:07.719687 [info ] [Thread-1 (]: 1 of 1 OK created sql table model raw_data_analytics.foreign_stock_change_rate_conditions  [[32mSUCCESS 1[0m in 2.92s]
[0m15:24:07.721832 [debug] [Thread-1 (]: Finished running node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:24:07.725866 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:24:07.726464 [debug] [MainThread]: Connection 'model.stock_elt.foreign_stock_change_rate_conditions' was properly closed.
[0m15:24:07.727048 [info ] [MainThread]: 
[0m15:24:07.727652 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 8.14 seconds (8.14s).
[0m15:24:07.728899 [debug] [MainThread]: Command end result
[0m15:24:07.768539 [info ] [MainThread]: 
[0m15:24:07.769673 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:24:07.770870 [info ] [MainThread]: 
[0m15:24:07.771640 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m15:24:07.774945 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 11.782479, "process_in_blocks": "90776", "process_kernel_time": 1.245501, "process_mem_max_rss": "126680", "process_out_blocks": "2904", "process_user_time": 4.354503}
[0m15:24:07.775710 [debug] [MainThread]: Command `dbt run` succeeded at 15:24:07.775575 after 11.78 seconds
[0m15:24:07.776118 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fa8ea32f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fa74dc110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1fa74de1b0>]}
[0m15:24:07.776541 [debug] [MainThread]: Flushing usage events
[0m15:27:40.990447 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb83869e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb843b7c20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb85bd0bc0>]}


============================== 15:27:41.012329 | 15acd2df-db62-46a2-b9e7-9005ae0595e5 ==============================
[0m15:27:41.012329 [info ] [MainThread]: Running with dbt=1.8.9
[0m15:27:41.013990 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/home/woong/.dbt', 'log_path': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt/stock_elt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:27:42.038794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '15acd2df-db62-46a2-b9e7-9005ae0595e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb84e9c080>]}
[0m15:27:42.120209 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '15acd2df-db62-46a2-b9e7-9005ae0595e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb821a2ab0>]}
[0m15:27:42.123418 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m15:27:42.226064 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m15:27:42.340487 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m15:27:42.341079 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '15acd2df-db62-46a2-b9e7-9005ae0595e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb81eb0110>]}
[0m15:27:43.829356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '15acd2df-db62-46a2-b9e7-9005ae0595e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb82346030>]}
[0m15:27:43.972457 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '15acd2df-db62-46a2-b9e7-9005ae0595e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb820865d0>]}
[0m15:27:43.973032 [info ] [MainThread]: Found 2 models, 1 source, 459 macros
[0m15:27:43.973624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '15acd2df-db62-46a2-b9e7-9005ae0595e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb821a2750>]}
[0m15:27:43.976942 [info ] [MainThread]: 
[0m15:27:43.978058 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:27:43.979976 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_Stock_Watcher'
[0m15:27:44.018147 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher"
[0m15:27:44.019279 [debug] [ThreadPool]: On list_Stock_Watcher: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "list_Stock_Watcher"} */
show terse schemas in database Stock_Watcher
    limit 10000
[0m15:27:44.020479 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:27:45.456043 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.435 seconds
[0m15:27:45.460060 [debug] [ThreadPool]: On list_Stock_Watcher: Close
[0m15:27:45.855895 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_Stock_Watcher, now list_Stock_Watcher_raw_data_analytics)
[0m15:27:45.873202 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher_raw_data_analytics"
[0m15:27:45.874179 [debug] [ThreadPool]: On list_Stock_Watcher_raw_data_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "list_Stock_Watcher_raw_data_analytics"} */
show objects in Stock_Watcher.raw_data_analytics limit 10000
[0m15:27:45.875296 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:27:46.985964 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.111 seconds
[0m15:27:46.988598 [debug] [ThreadPool]: On list_Stock_Watcher_raw_data_analytics: Close
[0m15:27:47.304903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '15acd2df-db62-46a2-b9e7-9005ae0595e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb81fa90d0>]}
[0m15:27:47.305822 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:27:47.306527 [info ] [MainThread]: 
[0m15:27:47.334048 [debug] [Thread-1 (]: Began running node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m15:27:47.334667 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_Stock_Watcher_raw_data_analytics, now model.stock_elt.src_foreign_stock_change_rate_conditions)
[0m15:27:47.335099 [debug] [Thread-1 (]: Began compiling node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m15:27:47.346147 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_elt.src_foreign_stock_change_rate_conditions"
[0m15:27:47.348605 [debug] [Thread-1 (]: Finished running node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m15:27:47.350387 [debug] [Thread-1 (]: Began running node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:27:47.351102 [info ] [Thread-1 (]: 1 of 1 START sql table model raw_data_analytics.foreign_stock_change_rate_conditions  [RUN]
[0m15:27:47.351742 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.stock_elt.src_foreign_stock_change_rate_conditions, now model.stock_elt.foreign_stock_change_rate_conditions)
[0m15:27:47.352494 [debug] [Thread-1 (]: Began compiling node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:27:47.409512 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_elt.foreign_stock_change_rate_conditions"
[0m15:27:47.410453 [debug] [Thread-1 (]: Began executing node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:27:47.446614 [debug] [Thread-1 (]: Writing runtime sql for node "model.stock_elt.foreign_stock_change_rate_conditions"
[0m15:27:47.453604 [debug] [Thread-1 (]: Using snowflake connection "model.stock_elt.foreign_stock_change_rate_conditions"
[0m15:27:47.454301 [debug] [Thread-1 (]: On model.stock_elt.foreign_stock_change_rate_conditions: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "node_id": "model.stock_elt.foreign_stock_change_rate_conditions"} */
create or replace transient table Stock_Watcher.raw_data_analytics.foreign_stock_change_rate_conditions
         as
        (WITH  __dbt__cte__src_foreign_stock_change_rate_conditions as (
WITH src_foreign_stock_info_complete AS ( 
 SELECT * FROM Stock_Watcher.raw_data.foreign_stock_info_complete
)
SELECT NAME
     , FULLNAME 
     , DATE 
     , "Close" 
 FROM src_foreign_stock_info_complete
), ranked_data AS (
    SELECT *,
        ("Close" - LAG("Close") OVER (PARTITION BY name, fullname ORDER BY date)) / LAG("Close") OVER (PARTITION BY name, fullname ORDER BY date) * 100 AS change,
       -- 한 시간 변화율 계산
        (LEAD("Close", 1) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS hour_change,
        -- 하루 변화율 계산
        (LEAD("Close", 9) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS i_day_change_mean,
        
        -- 3일 변화율 계산
        (LEAD("Close", 27) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS three_day_change,
        
        -- 일주일 변화율 계산
        (LEAD("Close", 45) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS weekly_change
    FROM __dbt__cte__src_foreign_stock_change_rate_conditions
),
aggregated_data AS (
    SELECT
        CASE
            WHEN change > 10 THEN 'Change > 10'
            WHEN change > 5 THEN 'Change > 5'
            WHEN change <= -10 THEN 'Change <= -10'
            WHEN change <= -5 THEN 'Change <= -5'
            ELSE 'Other'
        END AS condition,
        AVG(hour_change) AS hour_change_mean,
        AVG(i_day_change_mean) AS i_day_change_mean,
        AVG(three_day_change) AS three_day_change_mean,
        AVG(weekly_change) AS weekly_change_mean,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY hour_change) AS hour_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY i_day_change_mean) AS i_day_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY three_day_change) AS three_day_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY weekly_change) AS weekly_change_median
    FROM ranked_data
    WHERE change > 5 OR change <= -5
    GROUP BY condition
)

-- mean값
SELECT 
    'hour_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN hour_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN hour_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN hour_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN hour_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'i_day_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN i_day_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN i_day_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN i_day_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN i_day_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'three_day_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN three_day_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN three_day_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN three_day_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN three_day_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'weekly_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN weekly_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN weekly_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN weekly_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN weekly_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

-- median값
UNION ALL

SELECT 
    'hour_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN hour_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN hour_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN hour_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN hour_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'i_day_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN i_day_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN i_day_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN i_day_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN i_day_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'three_day_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN three_day_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN three_day_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN three_day_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN three_day_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'weekly_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN weekly_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN weekly_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN weekly_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN weekly_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric
        );
[0m15:27:47.454894 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:27:49.993403 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.538 seconds
[0m15:27:50.027354 [debug] [Thread-1 (]: On model.stock_elt.foreign_stock_change_rate_conditions: Close
[0m15:27:50.423114 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '15acd2df-db62-46a2-b9e7-9005ae0595e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb82318860>]}
[0m15:27:50.424103 [info ] [Thread-1 (]: 1 of 1 OK created sql table model raw_data_analytics.foreign_stock_change_rate_conditions  [[32mSUCCESS 1[0m in 3.07s]
[0m15:27:50.424922 [debug] [Thread-1 (]: Finished running node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:27:50.428260 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:27:50.428875 [debug] [MainThread]: Connection 'model.stock_elt.foreign_stock_change_rate_conditions' was properly closed.
[0m15:27:50.429252 [info ] [MainThread]: 
[0m15:27:50.429656 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 6.45 seconds (6.45s).
[0m15:27:50.430497 [debug] [MainThread]: Command end result
[0m15:27:50.463260 [info ] [MainThread]: 
[0m15:27:50.463866 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:27:50.464471 [info ] [MainThread]: 
[0m15:27:50.465957 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m15:27:50.469207 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 9.592789, "process_in_blocks": "90608", "process_kernel_time": 1.301059, "process_mem_max_rss": "128048", "process_out_blocks": "2904", "process_user_time": 4.751696}
[0m15:27:50.469829 [debug] [MainThread]: Command `dbt run` succeeded at 15:27:50.469713 after 9.59 seconds
[0m15:27:50.470940 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb83deeba0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb83869130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb81d85df0>]}
[0m15:27:50.471838 [debug] [MainThread]: Flushing usage events
[0m15:28:31.146740 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f969b00b8f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f969b42e0f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f969ce10ce0>]}


============================== 15:28:31.153495 | 7e623e27-facb-409c-8aca-a189050483cf ==============================
[0m15:28:31.153495 [info ] [MainThread]: Running with dbt=1.8.9
[0m15:28:31.154567 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt/stock_elt/logs', 'version_check': 'True', 'profiles_dir': '/home/woong/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:28:31.837253 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7e623e27-facb-409c-8aca-a189050483cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96993bbe00>]}
[0m15:28:31.905044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7e623e27-facb-409c-8aca-a189050483cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f969a9bb6e0>]}
[0m15:28:31.908029 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m15:28:32.011824 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m15:28:32.112679 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m15:28:32.113227 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '7e623e27-facb-409c-8aca-a189050483cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f969b3704a0>]}
[0m15:28:32.234052 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7e623e27-facb-409c-8aca-a189050483cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9699543bf0>]}
[0m15:28:32.347048 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7e623e27-facb-409c-8aca-a189050483cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9699542960>]}
[0m15:28:32.347898 [info ] [MainThread]: Found 2 models, 1 source, 459 macros
[0m15:28:32.348660 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7e623e27-facb-409c-8aca-a189050483cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f96993ba270>]}
[0m15:28:32.351798 [info ] [MainThread]: 
[0m15:28:32.353126 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:28:32.355663 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_Stock_Watcher'
[0m15:28:32.379772 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher"
[0m15:28:32.380672 [debug] [ThreadPool]: On list_Stock_Watcher: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "list_Stock_Watcher"} */
show terse schemas in database Stock_Watcher
    limit 10000
[0m15:28:32.381299 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:28:33.692378 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.311 seconds
[0m15:28:33.695131 [debug] [ThreadPool]: On list_Stock_Watcher: Close
[0m15:28:34.031385 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_Stock_Watcher, now list_Stock_Watcher_raw_data_analytics)
[0m15:28:34.049563 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher_raw_data_analytics"
[0m15:28:34.050251 [debug] [ThreadPool]: On list_Stock_Watcher_raw_data_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "list_Stock_Watcher_raw_data_analytics"} */
show objects in Stock_Watcher.raw_data_analytics limit 10000
[0m15:28:34.050628 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:28:35.231444 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.180 seconds
[0m15:28:35.238660 [debug] [ThreadPool]: On list_Stock_Watcher_raw_data_analytics: Close
[0m15:28:35.597546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7e623e27-facb-409c-8aca-a189050483cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9699598380>]}
[0m15:28:35.598294 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:28:35.598879 [info ] [MainThread]: 
[0m15:28:35.609655 [debug] [Thread-1 (]: Began running node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:28:35.610997 [info ] [Thread-1 (]: 1 of 1 START sql table model raw_data_analytics.foreign_stock_change_rate_conditions  [RUN]
[0m15:28:35.612027 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_Stock_Watcher_raw_data_analytics, now model.stock_elt.foreign_stock_change_rate_conditions)
[0m15:28:35.612596 [debug] [Thread-1 (]: Began compiling node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:28:35.638976 [debug] [Thread-1 (]: Compilation Error in model foreign_stock_change_rate_conditions (models/output/foreign_stock_change_rate_conditions.sql)
  dbt was unable to infer all dependencies for the model "foreign_stock_change_rate_conditions".
  This typically happens when ref() is placed within a conditional block.
  
  To fix this, add the following hint to the top of the model "foreign_stock_change_rate_conditions":
  
  -- depends_on: {{ ref('src_foreign_stock_change_rate_conditions') }}
[0m15:28:35.640601 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7e623e27-facb-409c-8aca-a189050483cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f969b3717c0>]}
[0m15:28:35.641364 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model raw_data_analytics.foreign_stock_change_rate_conditions  [[31mERROR[0m in 0.03s]
[0m15:28:35.642294 [debug] [Thread-1 (]: Finished running node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:28:35.643021 [debug] [Thread-1 (]: Began running node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m15:28:35.643517 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.stock_elt.foreign_stock_change_rate_conditions, now model.stock_elt.src_foreign_stock_change_rate_conditions)
[0m15:28:35.643903 [debug] [Thread-1 (]: Began compiling node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m15:28:35.653664 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_elt.src_foreign_stock_change_rate_conditions"
[0m15:28:35.656239 [debug] [Thread-1 (]: Finished running node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m15:28:35.658998 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:28:35.659648 [debug] [MainThread]: Connection 'model.stock_elt.src_foreign_stock_change_rate_conditions' was properly closed.
[0m15:28:35.660067 [info ] [MainThread]: 
[0m15:28:35.660646 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.31 seconds (3.31s).
[0m15:28:35.662062 [debug] [MainThread]: Command end result
[0m15:28:35.718236 [info ] [MainThread]: 
[0m15:28:35.718933 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:28:35.720009 [info ] [MainThread]: 
[0m15:28:35.721459 [error] [MainThread]:   Compilation Error in model foreign_stock_change_rate_conditions (models/output/foreign_stock_change_rate_conditions.sql)
  dbt was unable to infer all dependencies for the model "foreign_stock_change_rate_conditions".
  This typically happens when ref() is placed within a conditional block.
  
  To fix this, add the following hint to the top of the model "foreign_stock_change_rate_conditions":
  
  -- depends_on: {{ ref('src_foreign_stock_change_rate_conditions') }}
[0m15:28:35.722512 [info ] [MainThread]: 
[0m15:28:35.724137 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m15:28:35.727412 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 6.1844573, "process_in_blocks": "91248", "process_kernel_time": 0.300626, "process_mem_max_rss": "129556", "process_out_blocks": "2824", "process_user_time": 4.218473}
[0m15:28:35.728090 [debug] [MainThread]: Command `dbt run` failed at 15:28:35.727960 after 6.19 seconds
[0m15:28:35.728745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f969e13f380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f969ac50a70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f969ab6d3d0>]}
[0m15:28:35.729220 [debug] [MainThread]: Flushing usage events
[0m15:34:32.202500 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efcc4401910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efcc48562a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efcc4401a30>]}


============================== 15:34:32.214538 | 504cf2ca-793a-4481-aff0-1dfc47b99c07 ==============================
[0m15:34:32.214538 [info ] [MainThread]: Running with dbt=1.8.9
[0m15:34:32.215792 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt/stock_elt/logs', 'debug': 'False', 'profiles_dir': '/home/woong/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:34:33.165517 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '504cf2ca-793a-4481-aff0-1dfc47b99c07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efcc4a83ef0>]}
[0m15:34:33.265427 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '504cf2ca-793a-4481-aff0-1dfc47b99c07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efcc31964b0>]}
[0m15:34:33.269607 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m15:34:33.413815 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m15:34:33.565851 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m15:34:33.566395 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '504cf2ca-793a-4481-aff0-1dfc47b99c07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efcc2c141a0>]}
[0m15:34:35.127261 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '504cf2ca-793a-4481-aff0-1dfc47b99c07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efcc2dc47a0>]}
[0m15:34:35.273495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '504cf2ca-793a-4481-aff0-1dfc47b99c07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efcc29654c0>]}
[0m15:34:35.274327 [info ] [MainThread]: Found 2 models, 1 source, 459 macros
[0m15:34:35.274957 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '504cf2ca-793a-4481-aff0-1dfc47b99c07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efcc297d880>]}
[0m15:34:35.278345 [info ] [MainThread]: 
[0m15:34:35.279761 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:34:35.282503 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_Stock_Watcher'
[0m15:34:35.309482 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher"
[0m15:34:35.310427 [debug] [ThreadPool]: On list_Stock_Watcher: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "list_Stock_Watcher"} */
show terse schemas in database Stock_Watcher
    limit 10000
[0m15:34:35.311907 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:34:36.541615 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 1.230 seconds
[0m15:34:36.544991 [debug] [ThreadPool]: On list_Stock_Watcher: Close
[0m15:34:36.953195 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_Stock_Watcher, now create_Stock_Watcher_raw_data_analytics)
[0m15:34:36.954832 [debug] [ThreadPool]: Creating schema "database: "Stock_Watcher"
schema: "raw_data_analytics"
"
[0m15:34:36.965588 [debug] [ThreadPool]: Using snowflake connection "create_Stock_Watcher_raw_data_analytics"
[0m15:34:36.966122 [debug] [ThreadPool]: On create_Stock_Watcher_raw_data_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "create_Stock_Watcher_raw_data_analytics"} */
create schema if not exists Stock_Watcher.raw_data_analytics
[0m15:34:36.966433 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:34:38.078963 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.112 seconds
[0m15:34:38.081691 [debug] [ThreadPool]: On create_Stock_Watcher_raw_data_analytics: Close
[0m15:34:38.459613 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_Stock_Watcher_raw_data_analytics'
[0m15:34:38.473495 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher_raw_data_analytics"
[0m15:34:38.473964 [debug] [ThreadPool]: On list_Stock_Watcher_raw_data_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "list_Stock_Watcher_raw_data_analytics"} */
show objects in Stock_Watcher.raw_data_analytics limit 10000
[0m15:34:38.474246 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:34:39.424942 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.950 seconds
[0m15:34:39.429654 [debug] [ThreadPool]: On list_Stock_Watcher_raw_data_analytics: Close
[0m15:34:39.855592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '504cf2ca-793a-4481-aff0-1dfc47b99c07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efcc2b8d4f0>]}
[0m15:34:39.857935 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:34:39.859007 [info ] [MainThread]: 
[0m15:34:39.869625 [debug] [Thread-1 (]: Began running node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m15:34:39.870836 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_Stock_Watcher_raw_data_analytics, now model.stock_elt.src_foreign_stock_change_rate_conditions)
[0m15:34:39.871728 [debug] [Thread-1 (]: Began compiling node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m15:34:39.885097 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_elt.src_foreign_stock_change_rate_conditions"
[0m15:34:39.890976 [debug] [Thread-1 (]: Finished running node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m15:34:39.893851 [debug] [Thread-1 (]: Began running node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:34:39.895078 [info ] [Thread-1 (]: 1 of 1 START sql table model raw_data_analytics.foreign_stock_change_rate_conditions  [RUN]
[0m15:34:39.895989 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.stock_elt.src_foreign_stock_change_rate_conditions, now model.stock_elt.foreign_stock_change_rate_conditions)
[0m15:34:39.896809 [debug] [Thread-1 (]: Began compiling node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:34:39.974424 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_elt.foreign_stock_change_rate_conditions"
[0m15:34:39.975703 [debug] [Thread-1 (]: Began executing node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:34:40.019116 [debug] [Thread-1 (]: Writing runtime sql for node "model.stock_elt.foreign_stock_change_rate_conditions"
[0m15:34:40.028130 [debug] [Thread-1 (]: Using snowflake connection "model.stock_elt.foreign_stock_change_rate_conditions"
[0m15:34:40.028956 [debug] [Thread-1 (]: On model.stock_elt.foreign_stock_change_rate_conditions: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "node_id": "model.stock_elt.foreign_stock_change_rate_conditions"} */
create or replace transient table Stock_Watcher.raw_data_analytics.foreign_stock_change_rate_conditions
         as
        (WITH  __dbt__cte__src_foreign_stock_change_rate_conditions as (
WITH src_foreign_stock_info_complete AS ( 
 SELECT * FROM Stock_Watcher.raw_data.foreign_stock_info_complete
)
SELECT NAME
     , FULLNAME 
     , DATE 
     , "Close" 
 FROM src_foreign_stock_info_complete
), ranked_data AS (
    SELECT *,
        ("Close" - LAG("Close") OVER (PARTITION BY name, fullname ORDER BY date)) / LAG("Close") OVER (PARTITION BY name, fullname ORDER BY date) * 100 AS change,
       -- 한 시간 변화율 계산
        (LEAD("Close", 1) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS hour_change,
        -- 하루 변화율 계산
        (LEAD("Close", 9) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS i_day_change_mean,
        
        -- 3일 변화율 계산
        (LEAD("Close", 27) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS three_day_change,
        
        -- 일주일 변화율 계산
        (LEAD("Close", 45) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS weekly_change
    FROM __dbt__cte__src_foreign_stock_change_rate_conditions
),
aggregated_data AS (
    SELECT
        CASE
            WHEN change > 10 THEN 'Change > 10'
            WHEN change > 5 THEN 'Change > 5'
            WHEN change <= -10 THEN 'Change <= -10'
            WHEN change <= -5 THEN 'Change <= -5'
            ELSE 'Other'
        END AS condition,
        AVG(hour_change) AS hour_change_mean,
        AVG(i_day_change_mean) AS i_day_change_mean,
        AVG(three_day_change) AS three_day_change_mean,
        AVG(weekly_change) AS weekly_change_mean,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY hour_change) AS hour_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY i_day_change_mean) AS i_day_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY three_day_change) AS three_day_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY weekly_change) AS weekly_change_median
    FROM ranked_data
    WHERE change > 5 OR change <= -5
    GROUP BY condition
)

-- mean값
SELECT 
    'hour_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN hour_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN hour_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN hour_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN hour_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'i_day_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN i_day_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN i_day_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN i_day_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN i_day_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'three_day_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN three_day_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN three_day_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN three_day_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN three_day_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'weekly_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN weekly_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN weekly_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN weekly_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN weekly_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

-- median값
UNION ALL

SELECT 
    'hour_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN hour_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN hour_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN hour_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN hour_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'i_day_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN i_day_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN i_day_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN i_day_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN i_day_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'three_day_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN three_day_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN three_day_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN three_day_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN three_day_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'weekly_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN weekly_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN weekly_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN weekly_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN weekly_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric
        );
[0m15:34:40.029618 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:34:42.331351 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.301 seconds
[0m15:34:42.369030 [debug] [Thread-1 (]: On model.stock_elt.foreign_stock_change_rate_conditions: Close
[0m15:34:42.765366 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '504cf2ca-793a-4481-aff0-1dfc47b99c07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efcc2e80830>]}
[0m15:34:42.766672 [info ] [Thread-1 (]: 1 of 1 OK created sql table model raw_data_analytics.foreign_stock_change_rate_conditions  [[32mSUCCESS 1[0m in 2.87s]
[0m15:34:42.768096 [debug] [Thread-1 (]: Finished running node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:34:42.771290 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:34:42.771860 [debug] [MainThread]: Connection 'create_Stock_Watcher_raw_data_analytics' was properly closed.
[0m15:34:42.772334 [debug] [MainThread]: Connection 'model.stock_elt.foreign_stock_change_rate_conditions' was properly closed.
[0m15:34:42.772874 [info ] [MainThread]: 
[0m15:34:42.774006 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 7.49 seconds (7.49s).
[0m15:34:42.776858 [debug] [MainThread]: Command end result
[0m15:34:42.819180 [info ] [MainThread]: 
[0m15:34:42.820117 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:34:42.820655 [info ] [MainThread]: 
[0m15:34:42.821253 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m15:34:42.823833 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 10.702655, "process_in_blocks": "91080", "process_kernel_time": 1.005094, "process_mem_max_rss": "128216", "process_out_blocks": "2912", "process_user_time": 4.674636}
[0m15:34:42.824981 [debug] [MainThread]: Command `dbt run` succeeded at 15:34:42.824714 after 10.70 seconds
[0m15:34:42.825876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efcc4f4a3f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efcc4606780>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efcc3f2e570>]}
[0m15:34:42.826810 [debug] [MainThread]: Flushing usage events
[0m15:36:38.691228 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa3ddc1d610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa3ddc44320>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa3de577410>]}


============================== 15:36:38.710978 | 1e6c3312-7dda-4495-80f7-4c8227c50119 ==============================
[0m15:36:38.710978 [info ] [MainThread]: Running with dbt=1.8.9
[0m15:36:38.712611 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/home/woong/.dbt', 'log_path': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt/stock_elt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m15:36:39.589040 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1e6c3312-7dda-4495-80f7-4c8227c50119', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa3dc535610>]}
[0m15:36:39.694841 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1e6c3312-7dda-4495-80f7-4c8227c50119', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa3dca1f920>]}
[0m15:36:39.696684 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m15:36:40.008926 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m15:36:40.134152 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m15:36:40.135307 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '1e6c3312-7dda-4495-80f7-4c8227c50119', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa3dc2642f0>]}
[0m15:36:41.948387 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1e6c3312-7dda-4495-80f7-4c8227c50119', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa3dece2900>]}
[0m15:36:42.101636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1e6c3312-7dda-4495-80f7-4c8227c50119', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa3dc1b2db0>]}
[0m15:36:42.102307 [info ] [MainThread]: Found 2 models, 1 source, 459 macros
[0m15:36:42.102861 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1e6c3312-7dda-4495-80f7-4c8227c50119', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa3ddb37890>]}
[0m15:36:42.107259 [info ] [MainThread]: 
[0m15:36:42.108187 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:36:42.109702 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_Stock_Watcher'
[0m15:36:42.130064 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher"
[0m15:36:42.130774 [debug] [ThreadPool]: On list_Stock_Watcher: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "list_Stock_Watcher"} */
show terse schemas in database Stock_Watcher
    limit 10000
[0m15:36:42.131163 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:36:43.287834 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.156 seconds
[0m15:36:43.291190 [debug] [ThreadPool]: On list_Stock_Watcher: Close
[0m15:36:43.620832 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_Stock_Watcher, now list_Stock_Watcher_raw_data_analytics)
[0m15:36:43.636570 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher_raw_data_analytics"
[0m15:36:43.637039 [debug] [ThreadPool]: On list_Stock_Watcher_raw_data_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "list_Stock_Watcher_raw_data_analytics"} */
show objects in Stock_Watcher.raw_data_analytics limit 10000
[0m15:36:43.637358 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:36:44.746975 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.110 seconds
[0m15:36:44.749334 [debug] [ThreadPool]: On list_Stock_Watcher_raw_data_analytics: Close
[0m15:36:45.158618 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1e6c3312-7dda-4495-80f7-4c8227c50119', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa3dc572180>]}
[0m15:36:45.159657 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:36:45.160493 [info ] [MainThread]: 
[0m15:36:45.169544 [debug] [Thread-1 (]: Began running node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m15:36:45.171344 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_Stock_Watcher_raw_data_analytics, now model.stock_elt.src_foreign_stock_change_rate_conditions)
[0m15:36:45.172109 [debug] [Thread-1 (]: Began compiling node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m15:36:45.184856 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_elt.src_foreign_stock_change_rate_conditions"
[0m15:36:45.187563 [debug] [Thread-1 (]: Finished running node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m15:36:45.191344 [debug] [Thread-1 (]: Began running node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:36:45.193279 [info ] [Thread-1 (]: 1 of 1 START sql table model raw_data_analytics.foreign_stock_change_rate_conditions  [RUN]
[0m15:36:45.194882 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.stock_elt.src_foreign_stock_change_rate_conditions, now model.stock_elt.foreign_stock_change_rate_conditions)
[0m15:36:45.195890 [debug] [Thread-1 (]: Began compiling node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:36:45.288022 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_elt.foreign_stock_change_rate_conditions"
[0m15:36:45.289645 [debug] [Thread-1 (]: Began executing node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:36:45.331637 [debug] [Thread-1 (]: Writing runtime sql for node "model.stock_elt.foreign_stock_change_rate_conditions"
[0m15:36:45.339545 [debug] [Thread-1 (]: Using snowflake connection "model.stock_elt.foreign_stock_change_rate_conditions"
[0m15:36:45.340270 [debug] [Thread-1 (]: On model.stock_elt.foreign_stock_change_rate_conditions: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "node_id": "model.stock_elt.foreign_stock_change_rate_conditions"} */
create or replace transient table Stock_Watcher.raw_data_analytics.foreign_stock_change_rate_conditions
         as
        (WITH  __dbt__cte__src_foreign_stock_change_rate_conditions as (
WITH src_foreign_stock_info_complete AS ( 
 SELECT * FROM Stock_Watcher.raw_data.foreign_stock_info_complete
)
SELECT NAME
     , FULLNAME 
     , DATE 
     , "Close" 
 FROM src_foreign_stock_info_complete
), ranked_data AS (
    SELECT *,
        ("Close" - LAG("Close") OVER (PARTITION BY name, fullname ORDER BY date)) / LAG("Close") OVER (PARTITION BY name, fullname ORDER BY date) * 100 AS change,
       -- 한 시간 변화율 계산
        (LEAD("Close", 1) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS hour_change,
        -- 하루 변화율 계산
        (LEAD("Close", 9) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS i_day_change_mean,
        
        -- 3일 변화율 계산
        (LEAD("Close", 27) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS three_day_change,
        
        -- 일주일 변화율 계산
        (LEAD("Close", 45) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS weekly_change
    FROM __dbt__cte__src_foreign_stock_change_rate_conditions
),
aggregated_data AS (
    SELECT
        CASE
            WHEN change > 10 THEN 'Change > 10'
            WHEN change > 5 THEN 'Change > 5'
            WHEN change <= -10 THEN 'Change <= -10'
            WHEN change <= -5 THEN 'Change <= -5'
            ELSE 'Other'
        END AS condition,
        AVG(hour_change) AS hour_change_mean,
        AVG(i_day_change_mean) AS i_day_change_mean,
        AVG(three_day_change) AS three_day_change_mean,
        AVG(weekly_change) AS weekly_change_mean,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY hour_change) AS hour_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY i_day_change_mean) AS i_day_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY three_day_change) AS three_day_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY weekly_change) AS weekly_change_median
    FROM ranked_data
    WHERE change > 5 OR change <= -5
    GROUP BY condition
)

-- mean값
SELECT 
    'hour_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN hour_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN hour_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN hour_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN hour_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'i_day_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN i_day_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN i_day_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN i_day_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN i_day_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'three_day_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN three_day_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN three_day_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN three_day_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN three_day_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'weekly_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN weekly_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN weekly_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN weekly_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN weekly_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

-- median값
UNION ALL

SELECT 
    'hour_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN hour_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN hour_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN hour_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN hour_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'i_day_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN i_day_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN i_day_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN i_day_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN i_day_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'three_day_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN three_day_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN three_day_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN three_day_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN three_day_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'weekly_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN weekly_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN weekly_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN weekly_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN weekly_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric
        );
[0m15:36:45.340917 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:36:47.581721 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.241 seconds
[0m15:36:47.617360 [debug] [Thread-1 (]: On model.stock_elt.foreign_stock_change_rate_conditions: Close
[0m15:36:47.965426 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e6c3312-7dda-4495-80f7-4c8227c50119', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa3dc6cc830>]}
[0m15:36:47.966499 [info ] [Thread-1 (]: 1 of 1 OK created sql table model raw_data_analytics.foreign_stock_change_rate_conditions  [[32mSUCCESS 1[0m in 2.77s]
[0m15:36:47.967860 [debug] [Thread-1 (]: Finished running node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:36:47.972731 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:36:47.973605 [debug] [MainThread]: Connection 'model.stock_elt.foreign_stock_change_rate_conditions' was properly closed.
[0m15:36:47.974378 [info ] [MainThread]: 
[0m15:36:47.975068 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 5.87 seconds (5.87s).
[0m15:36:47.976187 [debug] [MainThread]: Command end result
[0m15:36:48.017200 [info ] [MainThread]: 
[0m15:36:48.018309 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:36:48.019515 [info ] [MainThread]: 
[0m15:36:48.020346 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m15:36:48.024921 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 9.409353, "process_in_blocks": "90624", "process_kernel_time": 0.403504, "process_mem_max_rss": "126832", "process_out_blocks": "2904", "process_user_time": 5.03911}
[0m15:36:48.026315 [debug] [MainThread]: Command `dbt run` succeeded at 15:36:48.026080 after 9.41 seconds
[0m15:36:48.027132 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa3dddd53a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa3dddd5460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa3dddd6e10>]}
[0m15:36:48.027868 [debug] [MainThread]: Flushing usage events
[0m15:41:48.133835 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efefddaa930>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efefdf84620>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efefd41e300>]}


============================== 15:41:48.140832 | 6256b401-551f-45a3-bf27-857a08764b9b ==============================
[0m15:41:48.140832 [info ] [MainThread]: Running with dbt=1.8.9
[0m15:41:48.142062 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/woong/.dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt/stock_elt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:41:48.880879 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6256b401-551f-45a3-bf27-857a08764b9b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efefb56b950>]}
[0m15:41:48.945307 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6256b401-551f-45a3-bf27-857a08764b9b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efefb56b950>]}
[0m15:41:48.948598 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m15:41:49.050360 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m15:41:49.148676 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m15:41:49.149279 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '6256b401-551f-45a3-bf27-857a08764b9b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efefb2983e0>]}
[0m15:41:50.600504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6256b401-551f-45a3-bf27-857a08764b9b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efefb38ff20>]}
[0m15:41:50.738346 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6256b401-551f-45a3-bf27-857a08764b9b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efefb1d25a0>]}
[0m15:41:50.738852 [info ] [MainThread]: Found 2 models, 1 source, 459 macros
[0m15:41:50.739375 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6256b401-551f-45a3-bf27-857a08764b9b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efefb3aa060>]}
[0m15:41:50.743170 [info ] [MainThread]: 
[0m15:41:50.743979 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:41:50.745367 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_Stock_Watcher'
[0m15:41:50.769784 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher"
[0m15:41:50.771169 [debug] [ThreadPool]: On list_Stock_Watcher: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "list_Stock_Watcher"} */
show terse schemas in database Stock_Watcher
    limit 10000
[0m15:41:50.771922 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:41:52.049459 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.277 seconds
[0m15:41:52.054077 [debug] [ThreadPool]: On list_Stock_Watcher: Close
[0m15:41:52.475743 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_Stock_Watcher, now list_Stock_Watcher_raw_data_analytics)
[0m15:41:52.485202 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher_raw_data_analytics"
[0m15:41:52.486027 [debug] [ThreadPool]: On list_Stock_Watcher_raw_data_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "list_Stock_Watcher_raw_data_analytics"} */
show objects in Stock_Watcher.raw_data_analytics limit 10000
[0m15:41:52.486754 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:41:53.675759 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.189 seconds
[0m15:41:53.679345 [debug] [ThreadPool]: On list_Stock_Watcher_raw_data_analytics: Close
[0m15:41:54.092869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6256b401-551f-45a3-bf27-857a08764b9b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efefb126690>]}
[0m15:41:54.094854 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:41:54.095952 [info ] [MainThread]: 
[0m15:41:54.105848 [debug] [Thread-1 (]: Began running node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m15:41:54.106831 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_Stock_Watcher_raw_data_analytics, now model.stock_elt.src_foreign_stock_change_rate_conditions)
[0m15:41:54.107546 [debug] [Thread-1 (]: Began compiling node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m15:41:54.120647 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_elt.src_foreign_stock_change_rate_conditions"
[0m15:41:54.121836 [debug] [Thread-1 (]: Finished running node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m15:41:54.123423 [debug] [Thread-1 (]: Began running node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:41:54.123927 [info ] [Thread-1 (]: 1 of 1 START sql table model raw_data_analytics.foreign_stock_change_rate_conditions  [RUN]
[0m15:41:54.124390 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.stock_elt.src_foreign_stock_change_rate_conditions, now model.stock_elt.foreign_stock_change_rate_conditions)
[0m15:41:54.125165 [debug] [Thread-1 (]: Began compiling node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:41:54.184362 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_elt.foreign_stock_change_rate_conditions"
[0m15:41:54.185188 [debug] [Thread-1 (]: Began executing node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:41:54.217544 [debug] [Thread-1 (]: Writing runtime sql for node "model.stock_elt.foreign_stock_change_rate_conditions"
[0m15:41:54.224179 [debug] [Thread-1 (]: Using snowflake connection "model.stock_elt.foreign_stock_change_rate_conditions"
[0m15:41:54.224923 [debug] [Thread-1 (]: On model.stock_elt.foreign_stock_change_rate_conditions: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "node_id": "model.stock_elt.foreign_stock_change_rate_conditions"} */
create or replace transient table Stock_Watcher.raw_data_analytics.foreign_stock_change_rate_conditions
         as
        (WITH  __dbt__cte__src_foreign_stock_change_rate_conditions as (
WITH src_foreign_stock_info_complete AS ( 
 SELECT * FROM Stock_Watcher.raw_data.foreign_stock_info_complete
)
SELECT NAME
     , FULLNAME 
     , DATE 
     , "Close" 
 FROM src_foreign_stock_info_complete
), ranked_data AS (
    SELECT *,
        ("Close" - LAG("Close") OVER (PARTITION BY name, fullname ORDER BY date)) / LAG("Close") OVER (PARTITION BY name, fullname ORDER BY date) * 100 AS change,
       -- 한 시간 변화율 계산
        (LEAD("Close", 1) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS hour_change,
        -- 하루 변화율 계산
        (LEAD("Close", 9) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS i_day_change_mean,
        
        -- 3일 변화율 계산
        (LEAD("Close", 27) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS three_day_change,
        
        -- 일주일 변화율 계산
        (LEAD("Close", 45) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS weekly_change
    FROM __dbt__cte__src_foreign_stock_change_rate_conditions
),
aggregated_data AS (
    SELECT
        CASE
            WHEN change > 10 THEN 'Change > 10'
            WHEN change > 5 THEN 'Change > 5'
            WHEN change <= -10 THEN 'Change <= -10'
            WHEN change <= -5 THEN 'Change <= -5'
            ELSE 'Other'
        END AS condition,
        AVG(hour_change) AS hour_change_mean,
        AVG(i_day_change_mean) AS i_day_change_mean,
        AVG(three_day_change) AS three_day_change_mean,
        AVG(weekly_change) AS weekly_change_mean,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY hour_change) AS hour_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY i_day_change_mean) AS i_day_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY three_day_change) AS three_day_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY weekly_change) AS weekly_change_median
    FROM ranked_data
    WHERE change > 5 OR change <= -5
    GROUP BY condition
)

-- mean값
SELECT 
    'hour_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN hour_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN hour_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN hour_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN hour_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'i_day_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN i_day_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN i_day_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN i_day_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN i_day_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'three_day_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN three_day_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN three_day_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN three_day_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN three_day_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'weekly_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN weekly_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN weekly_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN weekly_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN weekly_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

-- median값
UNION ALL

SELECT 
    'hour_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN hour_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN hour_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN hour_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN hour_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'i_day_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN i_day_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN i_day_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN i_day_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN i_day_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'three_day_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN three_day_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN three_day_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN three_day_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN three_day_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'weekly_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN weekly_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN weekly_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN weekly_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN weekly_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric
        );
[0m15:41:54.225554 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:41:56.392543 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.167 seconds
[0m15:41:56.430327 [debug] [Thread-1 (]: On model.stock_elt.foreign_stock_change_rate_conditions: Close
[0m15:41:56.889530 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6256b401-551f-45a3-bf27-857a08764b9b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efefb504920>]}
[0m15:41:56.890661 [info ] [Thread-1 (]: 1 of 1 OK created sql table model raw_data_analytics.foreign_stock_change_rate_conditions  [[32mSUCCESS 1[0m in 2.76s]
[0m15:41:56.891550 [debug] [Thread-1 (]: Finished running node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:41:56.894622 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:41:56.895188 [debug] [MainThread]: Connection 'model.stock_elt.foreign_stock_change_rate_conditions' was properly closed.
[0m15:41:56.895912 [info ] [MainThread]: 
[0m15:41:56.896639 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 6.15 seconds (6.15s).
[0m15:41:56.897913 [debug] [MainThread]: Command end result
[0m15:41:56.933619 [info ] [MainThread]: 
[0m15:41:56.934628 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:41:56.935375 [info ] [MainThread]: 
[0m15:41:56.936163 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m15:41:56.939356 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 8.929872, "process_in_blocks": "90608", "process_kernel_time": 0.271592, "process_mem_max_rss": "128504", "process_out_blocks": "2896", "process_user_time": 4.598335}
[0m15:41:56.940343 [debug] [MainThread]: Command `dbt run` succeeded at 15:41:56.940157 after 8.93 seconds
[0m15:41:56.941213 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efefd7e95b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efefd4f94f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efefd4f9d30>]}
[0m15:41:56.941720 [debug] [MainThread]: Flushing usage events
[0m15:45:32.347270 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f13d6eb5460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f13d5579220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f13d6e809e0>]}


============================== 15:45:32.353473 | c7d11ee2-6951-45ba-aca8-7c5bc109b969 ==============================
[0m15:45:32.353473 [info ] [MainThread]: Running with dbt=1.8.9
[0m15:45:32.354600 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/woong/.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt/stock_elt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:45:33.233712 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c7d11ee2-6951-45ba-aca8-7c5bc109b969', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f13d347bb60>]}
[0m15:45:33.307265 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c7d11ee2-6951-45ba-aca8-7c5bc109b969', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f13d3caa2a0>]}
[0m15:45:33.310458 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m15:45:33.428966 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m15:45:33.524791 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m15:45:33.525442 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'c7d11ee2-6951-45ba-aca8-7c5bc109b969', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f13d53e07a0>]}
[0m15:45:34.839714 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c7d11ee2-6951-45ba-aca8-7c5bc109b969', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f13d3171ca0>]}
[0m15:45:34.967263 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c7d11ee2-6951-45ba-aca8-7c5bc109b969', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f13d34ea300>]}
[0m15:45:34.968477 [info ] [MainThread]: Found 2 models, 1 source, 459 macros
[0m15:45:34.969425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c7d11ee2-6951-45ba-aca8-7c5bc109b969', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f13d32162d0>]}
[0m15:45:34.974783 [info ] [MainThread]: 
[0m15:45:34.976440 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:45:34.979114 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_Stock_Watcher'
[0m15:45:35.009130 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher"
[0m15:45:35.009716 [debug] [ThreadPool]: On list_Stock_Watcher: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "list_Stock_Watcher"} */
show terse schemas in database Stock_Watcher
    limit 10000
[0m15:45:35.010130 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:45:36.109498 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.099 seconds
[0m15:45:36.114090 [debug] [ThreadPool]: On list_Stock_Watcher: Close
[0m15:45:36.578235 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_Stock_Watcher_raw_data_analytics'
[0m15:45:36.590771 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher_raw_data_analytics"
[0m15:45:36.591706 [debug] [ThreadPool]: On list_Stock_Watcher_raw_data_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "list_Stock_Watcher_raw_data_analytics"} */
show objects in Stock_Watcher.raw_data_analytics limit 10000
[0m15:45:36.592510 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:45:37.681822 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.089 seconds
[0m15:45:37.687168 [debug] [ThreadPool]: On list_Stock_Watcher_raw_data_analytics: Close
[0m15:45:38.082587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c7d11ee2-6951-45ba-aca8-7c5bc109b969', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f13d3319430>]}
[0m15:45:38.083476 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:45:38.084132 [info ] [MainThread]: 
[0m15:45:38.091417 [debug] [Thread-1 (]: Began running node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m15:45:38.092008 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_Stock_Watcher_raw_data_analytics, now model.stock_elt.src_foreign_stock_change_rate_conditions)
[0m15:45:38.092413 [debug] [Thread-1 (]: Began compiling node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m15:45:38.099622 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_elt.src_foreign_stock_change_rate_conditions"
[0m15:45:38.100696 [debug] [Thread-1 (]: Finished running node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m15:45:38.102833 [debug] [Thread-1 (]: Began running node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:45:38.104001 [info ] [Thread-1 (]: 1 of 1 START sql table model raw_data_analytics.foreign_stock_change_rate_conditions  [RUN]
[0m15:45:38.105305 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.stock_elt.src_foreign_stock_change_rate_conditions, now model.stock_elt.foreign_stock_change_rate_conditions)
[0m15:45:38.106433 [debug] [Thread-1 (]: Began compiling node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:45:38.161364 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_elt.foreign_stock_change_rate_conditions"
[0m15:45:38.162181 [debug] [Thread-1 (]: Began executing node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:45:38.193774 [debug] [Thread-1 (]: Writing runtime sql for node "model.stock_elt.foreign_stock_change_rate_conditions"
[0m15:45:38.200127 [debug] [Thread-1 (]: Using snowflake connection "model.stock_elt.foreign_stock_change_rate_conditions"
[0m15:45:38.200851 [debug] [Thread-1 (]: On model.stock_elt.foreign_stock_change_rate_conditions: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "node_id": "model.stock_elt.foreign_stock_change_rate_conditions"} */
create or replace transient table Stock_Watcher.raw_data_analytics.foreign_stock_change_rate_conditions
         as
        (WITH  __dbt__cte__src_foreign_stock_change_rate_conditions as (
WITH src_foreign_stock_info_complete AS ( 
 SELECT * FROM Stock_Watcher.raw_data.foreign_stock_info_complete
)
SELECT NAME
     , FULLNAME 
     , DATE 
     , "Close" 
 FROM src_foreign_stock_info_complete
), ranked_data AS (
    SELECT *,
        ("Close" - LAG("Close") OVER (PARTITION BY name, fullname ORDER BY date)) / LAG("Close") OVER (PARTITION BY name, fullname ORDER BY date) * 100 AS change,
       -- 한 시간 변화율 계산
        (LEAD("Close", 1) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS hour_change,
        -- 하루 변화율 계산
        (LEAD("Close", 9) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS i_day_change_mean,
        
        -- 3일 변화율 계산
        (LEAD("Close", 27) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS three_day_change,
        
        -- 일주일 변화율 계산
        (LEAD("Close", 45) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS weekly_change
    FROM __dbt__cte__src_foreign_stock_change_rate_conditions
),
aggregated_data AS (
    SELECT
        CASE
            WHEN change > 10 THEN 'Change > 10'
            WHEN change > 5 THEN 'Change > 5'
            WHEN change <= -10 THEN 'Change <= -10'
            WHEN change <= -5 THEN 'Change <= -5'
            ELSE 'Other'
        END AS condition,
        AVG(hour_change) AS hour_change_mean,
        AVG(i_day_change_mean) AS i_day_change_mean,
        AVG(three_day_change) AS three_day_change_mean,
        AVG(weekly_change) AS weekly_change_mean,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY hour_change) AS hour_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY i_day_change_mean) AS i_day_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY three_day_change) AS three_day_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY weekly_change) AS weekly_change_median
    FROM ranked_data
    WHERE change > 5 OR change <= -5
    GROUP BY condition
)

-- mean값
SELECT 
    'hour_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN hour_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN hour_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN hour_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN hour_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'i_day_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN i_day_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN i_day_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN i_day_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN i_day_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'three_day_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN three_day_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN three_day_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN three_day_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN three_day_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'weekly_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN weekly_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN weekly_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN weekly_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN weekly_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

-- median값
UNION ALL

SELECT 
    'hour_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN hour_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN hour_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN hour_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN hour_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'i_day_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN i_day_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN i_day_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN i_day_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN i_day_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'three_day_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN three_day_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN three_day_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN three_day_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN three_day_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'weekly_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN weekly_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN weekly_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN weekly_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN weekly_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric
        );
[0m15:45:38.201419 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:45:40.558038 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.356 seconds
[0m15:45:40.601130 [debug] [Thread-1 (]: On model.stock_elt.foreign_stock_change_rate_conditions: Close
[0m15:45:40.990606 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c7d11ee2-6951-45ba-aca8-7c5bc109b969', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f13d3584920>]}
[0m15:45:40.992336 [info ] [Thread-1 (]: 1 of 1 OK created sql table model raw_data_analytics.foreign_stock_change_rate_conditions  [[32mSUCCESS 1[0m in 2.88s]
[0m15:45:40.994211 [debug] [Thread-1 (]: Finished running node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:45:40.998418 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:45:40.999315 [debug] [MainThread]: Connection 'list_Stock_Watcher' was properly closed.
[0m15:45:40.999820 [debug] [MainThread]: Connection 'model.stock_elt.foreign_stock_change_rate_conditions' was properly closed.
[0m15:45:41.000191 [info ] [MainThread]: 
[0m15:45:41.000740 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 6.02 seconds (6.02s).
[0m15:45:41.001607 [debug] [MainThread]: Command end result
[0m15:45:41.037598 [info ] [MainThread]: 
[0m15:45:41.038305 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:45:41.038789 [info ] [MainThread]: 
[0m15:45:41.039307 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m15:45:41.045532 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 8.75412, "process_in_blocks": "90616", "process_kernel_time": 0.235691, "process_mem_max_rss": "128424", "process_out_blocks": "2896", "process_user_time": 3.950187}
[0m15:45:41.046590 [debug] [MainThread]: Command `dbt run` succeeded at 15:45:41.046267 after 8.76 seconds
[0m15:45:41.048239 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f13d50bc620>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f13d50bf2f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f13d3214fe0>]}
[0m15:45:41.049652 [debug] [MainThread]: Flushing usage events
[0m15:46:47.098436 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efccead7260>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efccf1bee40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efccebddaf0>]}


============================== 15:46:47.105051 | aadd7db0-297d-4cd1-81bd-9219ba53f0dc ==============================
[0m15:46:47.105051 [info ] [MainThread]: Running with dbt=1.8.9
[0m15:46:47.106416 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt/stock_elt/logs', 'profiles_dir': '/home/woong/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m15:46:47.775380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'aadd7db0-297d-4cd1-81bd-9219ba53f0dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efcccb34860>]}
[0m15:46:47.848117 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'aadd7db0-297d-4cd1-81bd-9219ba53f0dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efcccafa9f0>]}
[0m15:46:47.850800 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m15:46:47.968163 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m15:46:48.088011 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m15:46:48.088679 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'aadd7db0-297d-4cd1-81bd-9219ba53f0dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efccead47a0>]}
[0m15:46:49.478211 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aadd7db0-297d-4cd1-81bd-9219ba53f0dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efccc884b00>]}
[0m15:46:48.095403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aadd7db0-297d-4cd1-81bd-9219ba53f0dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efcccb35520>]}
[0m15:46:48.096124 [info ] [MainThread]: Found 2 models, 1 source, 459 macros
[0m15:46:48.096746 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aadd7db0-297d-4cd1-81bd-9219ba53f0dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efccf70e360>]}
[0m15:46:48.100345 [info ] [MainThread]: 
[0m15:46:48.101685 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:46:48.108806 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_Stock_Watcher'
[0m15:46:48.130050 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher"
[0m15:46:48.130645 [debug] [ThreadPool]: On list_Stock_Watcher: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "list_Stock_Watcher"} */
show terse schemas in database Stock_Watcher
    limit 10000
[0m15:46:48.131024 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:46:49.522294 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.391 seconds
[0m15:46:49.525073 [debug] [ThreadPool]: On list_Stock_Watcher: Close
[0m15:46:49.915246 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_Stock_Watcher, now list_Stock_Watcher_raw_data_analytics)
[0m15:46:49.927227 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher_raw_data_analytics"
[0m15:46:49.927680 [debug] [ThreadPool]: On list_Stock_Watcher_raw_data_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "list_Stock_Watcher_raw_data_analytics"} */
show objects in Stock_Watcher.raw_data_analytics limit 10000
[0m15:46:49.927967 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:46:51.130426 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.202 seconds
[0m15:46:51.133648 [debug] [ThreadPool]: On list_Stock_Watcher_raw_data_analytics: Close
[0m15:46:51.440040 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aadd7db0-297d-4cd1-81bd-9219ba53f0dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efccc7ab8c0>]}
[0m15:46:51.441303 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:46:51.442149 [info ] [MainThread]: 
[0m15:46:51.448780 [debug] [Thread-1 (]: Began running node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m15:46:51.449881 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_Stock_Watcher_raw_data_analytics, now model.stock_elt.src_foreign_stock_change_rate_conditions)
[0m15:46:51.450543 [debug] [Thread-1 (]: Began compiling node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m15:46:51.467602 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_elt.src_foreign_stock_change_rate_conditions"
[0m15:46:51.469104 [debug] [Thread-1 (]: Finished running node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m15:46:51.470917 [debug] [Thread-1 (]: Began running node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:46:51.472995 [info ] [Thread-1 (]: 1 of 1 START sql table model raw_data_analytics.foreign_stock_change_rate_conditions  [RUN]
[0m15:46:51.477254 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.stock_elt.src_foreign_stock_change_rate_conditions, now model.stock_elt.foreign_stock_change_rate_conditions)
[0m15:46:51.478292 [debug] [Thread-1 (]: Began compiling node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:46:51.599894 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_elt.foreign_stock_change_rate_conditions"
[0m15:46:51.601554 [debug] [Thread-1 (]: Began executing node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:46:51.700583 [debug] [Thread-1 (]: Writing runtime sql for node "model.stock_elt.foreign_stock_change_rate_conditions"
[0m15:46:51.718489 [debug] [Thread-1 (]: Using snowflake connection "model.stock_elt.foreign_stock_change_rate_conditions"
[0m15:46:51.720363 [debug] [Thread-1 (]: On model.stock_elt.foreign_stock_change_rate_conditions: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "node_id": "model.stock_elt.foreign_stock_change_rate_conditions"} */
create or replace transient table Stock_Watcher.raw_data_analytics.foreign_stock_change_rate_conditions
         as
        (WITH  __dbt__cte__src_foreign_stock_change_rate_conditions as (
WITH src_foreign_stock_info_complete AS ( 
 SELECT * FROM Stock_Watcher.raw_data.foreign_stock_info_complete
)
SELECT NAME
     , FULLNAME 
     , DATE 
     , "Close" 
 FROM src_foreign_stock_info_complete
), ranked_data AS (
    SELECT *,
        ("Close" - LAG("Close") OVER (PARTITION BY name, fullname ORDER BY date)) / LAG("Close") OVER (PARTITION BY name, fullname ORDER BY date) * 100 AS change,
       -- 한 시간 변화율 계산
        (LEAD("Close", 1) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS hour_change,
        -- 하루 변화율 계산
        (LEAD("Close", 9) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS i_day_change_mean,
        
        -- 3일 변화율 계산
        (LEAD("Close", 27) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS three_day_change,
        
        -- 일주일 변화율 계산
        (LEAD("Close", 45) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS weekly_change
    FROM __dbt__cte__src_foreign_stock_change_rate_conditions
),
aggregated_data AS (
    SELECT
        CASE
            WHEN change > 10 THEN 'Change > 10'
            WHEN change > 5 THEN 'Change > 5'
            WHEN change <= -10 THEN 'Change <= -10'
            WHEN change <= -5 THEN 'Change <= -5'
            ELSE 'Other'
        END AS condition,
        AVG(hour_change) AS hour_change_mean,
        AVG(i_day_change_mean) AS i_day_change_mean,
        AVG(three_day_change) AS three_day_change_mean,
        AVG(weekly_change) AS weekly_change_mean,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY hour_change) AS hour_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY i_day_change_mean) AS i_day_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY three_day_change) AS three_day_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY weekly_change) AS weekly_change_median
    FROM ranked_data
    WHERE change > 5 OR change <= -5
    GROUP BY condition
)

-- mean값
SELECT 
    'hour_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN hour_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN hour_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN hour_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN hour_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'i_day_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN i_day_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN i_day_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN i_day_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN i_day_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'three_day_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN three_day_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN three_day_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN three_day_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN three_day_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'weekly_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN weekly_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN weekly_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN weekly_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN weekly_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

-- median값
UNION ALL

SELECT 
    'hour_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN hour_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN hour_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN hour_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN hour_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'i_day_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN i_day_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN i_day_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN i_day_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN i_day_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'three_day_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN three_day_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN three_day_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN three_day_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN three_day_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'weekly_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN weekly_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN weekly_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN weekly_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN weekly_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric
        );
[0m15:46:51.722064 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:46:53.982026 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.260 seconds
[0m15:46:54.015314 [debug] [Thread-1 (]: On model.stock_elt.foreign_stock_change_rate_conditions: Close
[0m15:46:54.312693 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aadd7db0-297d-4cd1-81bd-9219ba53f0dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efcccc909b0>]}
[0m15:46:54.314309 [info ] [Thread-1 (]: 1 of 1 OK created sql table model raw_data_analytics.foreign_stock_change_rate_conditions  [[32mSUCCESS 1[0m in 2.83s]
[0m15:46:54.315899 [debug] [Thread-1 (]: Finished running node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:46:54.319966 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:46:54.320544 [debug] [MainThread]: Connection 'model.stock_elt.foreign_stock_change_rate_conditions' was properly closed.
[0m15:46:54.320935 [info ] [MainThread]: 
[0m15:46:54.321417 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 6.22 seconds (6.22s).
[0m15:46:54.322256 [debug] [MainThread]: Command end result
[0m15:46:54.354935 [info ] [MainThread]: 
[0m15:46:54.355516 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:46:54.356128 [info ] [MainThread]: 
[0m15:46:54.356960 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m15:46:54.360113 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 8.857368, "process_in_blocks": "90640", "process_kernel_time": 0.198713, "process_mem_max_rss": "128944", "process_out_blocks": "2896", "process_user_time": 4.361755}
[0m15:46:54.361030 [debug] [MainThread]: Command `dbt run` succeeded at 15:46:54.360881 after 8.86 seconds
[0m15:46:54.362263 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efccef33e60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efcce77f290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efcccb1a480>]}
[0m15:46:54.363484 [debug] [MainThread]: Flushing usage events
[0m15:47:44.686365 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb65f7ddf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb64decd10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb657de450>]}


============================== 15:47:44.690065 | 8ad5c996-5896-4be6-bea8-bf2694684e6d ==============================
[0m15:47:44.690065 [info ] [MainThread]: Running with dbt=1.8.9
[0m15:47:44.691319 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/home/woong/.dbt', 'log_path': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt/stock_elt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:47:45.078653 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8ad5c996-5896-4be6-bea8-bf2694684e6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb63947c50>]}
[0m15:47:45.139733 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8ad5c996-5896-4be6-bea8-bf2694684e6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb6380a900>]}
[0m15:47:45.140514 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m15:47:45.229368 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m15:47:45.332047 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m15:47:45.332740 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '8ad5c996-5896-4be6-bea8-bf2694684e6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb633fc350>]}
[0m15:47:46.671496 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8ad5c996-5896-4be6-bea8-bf2694684e6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb63525760>]}
[0m15:47:46.757401 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8ad5c996-5896-4be6-bea8-bf2694684e6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb64cfd1c0>]}
[0m15:47:46.757931 [info ] [MainThread]: Found 2 models, 1 source, 459 macros
[0m15:47:46.758425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8ad5c996-5896-4be6-bea8-bf2694684e6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb64cde8d0>]}
[0m15:47:46.761067 [info ] [MainThread]: 
[0m15:47:46.762136 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:47:46.763914 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_Stock_Watcher'
[0m15:47:46.783047 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher"
[0m15:47:46.783509 [debug] [ThreadPool]: On list_Stock_Watcher: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "list_Stock_Watcher"} */
show terse schemas in database Stock_Watcher
    limit 10000
[0m15:47:46.783788 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:47:47.970396 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.187 seconds
[0m15:47:47.972058 [debug] [ThreadPool]: On list_Stock_Watcher: Close
[0m15:47:48.376083 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_Stock_Watcher, now list_Stock_Watcher_raw_data_analytics)
[0m15:47:48.391741 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher_raw_data_analytics"
[0m15:47:48.392340 [debug] [ThreadPool]: On list_Stock_Watcher_raw_data_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "list_Stock_Watcher_raw_data_analytics"} */
show objects in Stock_Watcher.raw_data_analytics limit 10000
[0m15:47:48.392827 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:47:49.492240 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.099 seconds
[0m15:47:49.495573 [debug] [ThreadPool]: On list_Stock_Watcher_raw_data_analytics: Close
[0m15:47:49.875231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8ad5c996-5896-4be6-bea8-bf2694684e6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb63715e20>]}
[0m15:47:49.876454 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:47:49.877150 [info ] [MainThread]: 
[0m15:47:49.885226 [debug] [Thread-1 (]: Began running node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m15:47:49.886267 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_Stock_Watcher_raw_data_analytics, now model.stock_elt.src_foreign_stock_change_rate_conditions)
[0m15:47:49.887132 [debug] [Thread-1 (]: Began compiling node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m15:47:49.894580 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_elt.src_foreign_stock_change_rate_conditions"
[0m15:47:49.895447 [debug] [Thread-1 (]: Finished running node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m15:47:49.896942 [debug] [Thread-1 (]: Began running node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:47:49.897514 [info ] [Thread-1 (]: 1 of 1 START sql table model raw_data_analytics.foreign_stock_change_rate_conditions  [RUN]
[0m15:47:49.898302 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.stock_elt.src_foreign_stock_change_rate_conditions, now model.stock_elt.foreign_stock_change_rate_conditions)
[0m15:47:49.899168 [debug] [Thread-1 (]: Began compiling node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:47:49.962108 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_elt.foreign_stock_change_rate_conditions"
[0m15:47:49.963008 [debug] [Thread-1 (]: Began executing node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:47:49.995065 [debug] [Thread-1 (]: Writing runtime sql for node "model.stock_elt.foreign_stock_change_rate_conditions"
[0m15:47:50.000794 [debug] [Thread-1 (]: Using snowflake connection "model.stock_elt.foreign_stock_change_rate_conditions"
[0m15:47:50.001486 [debug] [Thread-1 (]: On model.stock_elt.foreign_stock_change_rate_conditions: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "node_id": "model.stock_elt.foreign_stock_change_rate_conditions"} */
create or replace transient table Stock_Watcher.raw_data_analytics.foreign_stock_change_rate_conditions
         as
        (WITH  __dbt__cte__src_foreign_stock_change_rate_conditions as (
WITH src_foreign_stock_info_complete AS ( 
 SELECT * FROM Stock_Watcher.raw_data.foreign_stock_info_complete
)
SELECT NAME
     , FULLNAME 
     , DATE 
     , "Close" 
 FROM src_foreign_stock_info_complete
), ranked_data AS (
    SELECT *,
        ("Close" - LAG("Close") OVER (PARTITION BY name, fullname ORDER BY date)) / LAG("Close") OVER (PARTITION BY name, fullname ORDER BY date) * 100 AS change,
       -- 한 시간 변화율 계산
        (LEAD("Close", 1) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS hour_change,
        -- 하루 변화율 계산
        (LEAD("Close", 9) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS i_day_change_mean,
        
        -- 3일 변화율 계산
        (LEAD("Close", 27) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS three_day_change,
        
        -- 일주일 변화율 계산
        (LEAD("Close", 45) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS weekly_change
    FROM __dbt__cte__src_foreign_stock_change_rate_conditions
),
aggregated_data AS (
    SELECT
        CASE
            WHEN change > 10 THEN 'Change > 10'
            WHEN change > 5 THEN 'Change > 5'
            WHEN change <= -10 THEN 'Change <= -10'
            WHEN change <= -5 THEN 'Change <= -5'
            ELSE 'Other'
        END AS condition,
        AVG(hour_change) AS hour_change_mean,
        AVG(i_day_change_mean) AS i_day_change_mean,
        AVG(three_day_change) AS three_day_change_mean,
        AVG(weekly_change) AS weekly_change_mean,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY hour_change) AS hour_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY i_day_change_mean) AS i_day_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY three_day_change) AS three_day_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY weekly_change) AS weekly_change_median
    FROM ranked_data
    WHERE change > 5 OR change <= -5
    GROUP BY condition
)

-- mean값
SELECT 
    'hour_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN hour_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN hour_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN hour_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN hour_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'i_day_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN i_day_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN i_day_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN i_day_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN i_day_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'three_day_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN three_day_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN three_day_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN three_day_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN three_day_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'weekly_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN weekly_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN weekly_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN weekly_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN weekly_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

-- median값
UNION ALL

SELECT 
    'hour_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN hour_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN hour_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN hour_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN hour_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'i_day_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN i_day_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN i_day_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN i_day_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN i_day_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'three_day_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN three_day_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN three_day_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN three_day_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN three_day_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'weekly_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN weekly_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN weekly_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN weekly_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN weekly_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric
        );
[0m15:47:50.002054 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:47:50.622632 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.232 seconds
[0m15:47:50.655576 [debug] [Thread-1 (]: On model.stock_elt.foreign_stock_change_rate_conditions: Close
[0m15:47:51.053567 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8ad5c996-5896-4be6-bea8-bf2694684e6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb63874830>]}
[0m15:47:51.054774 [info ] [Thread-1 (]: 1 of 1 OK created sql table model raw_data_analytics.foreign_stock_change_rate_conditions  [[32mSUCCESS 1[0m in 1.15s]
[0m15:47:51.056509 [debug] [Thread-1 (]: Finished running node model.stock_elt.foreign_stock_change_rate_conditions
[0m15:47:51.062190 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:47:51.062961 [debug] [MainThread]: Connection 'model.stock_elt.foreign_stock_change_rate_conditions' was properly closed.
[0m15:47:51.063606 [info ] [MainThread]: 
[0m15:47:51.064299 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.30 seconds (4.30s).
[0m15:47:51.066414 [debug] [MainThread]: Command end result
[0m15:47:51.098890 [info ] [MainThread]: 
[0m15:47:51.100925 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:47:51.102095 [info ] [MainThread]: 
[0m15:47:51.103404 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m15:47:51.105404 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 8.106934, "process_in_blocks": "0", "process_kernel_time": 0.163373, "process_mem_max_rss": "128768", "process_out_blocks": "2904", "process_user_time": 3.853681}
[0m15:47:51.106157 [debug] [MainThread]: Command `dbt run` succeeded at 15:47:51.106013 after 8.11 seconds
[0m15:47:51.106646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb65f7ddf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb64f67ce0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb6847f380>]}
[0m15:47:51.107067 [debug] [MainThread]: Flushing usage events
[0m10:14:23.132889 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbe8d343dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbe8bad3d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbe8c328140>]}


============================== 10:14:23.153946 | da213e96-ef58-450c-bc55-3391c82fce1d ==============================
[0m10:14:23.153946 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:14:23.154474 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/home/woong/.dbt', 'log_path': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt/stock_elt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt test', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:14:24.434291 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'da213e96-ef58-450c-bc55-3391c82fce1d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbe8cc93ef0>]}
[0m10:14:24.497031 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'da213e96-ef58-450c-bc55-3391c82fce1d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbe8a17c200>]}
[0m10:14:24.499344 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m10:14:24.600346 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m10:14:24.746979 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m10:14:24.747440 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'da213e96-ef58-450c-bc55-3391c82fce1d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbe89e88ad0>]}
[0m10:14:25.983106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'da213e96-ef58-450c-bc55-3391c82fce1d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbe8a477e30>]}
[0m10:14:26.169326 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'da213e96-ef58-450c-bc55-3391c82fce1d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbe8a17d610>]}
[0m10:14:26.170083 [info ] [MainThread]: Found 2 models, 1 source, 459 macros
[0m10:14:26.170667 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'da213e96-ef58-450c-bc55-3391c82fce1d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbe89e4cf50>]}
[0m10:14:26.172797 [info ] [MainThread]: 
[0m10:14:26.173252 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m10:14:26.173731 [debug] [MainThread]: Command end result
[0m10:14:26.212293 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.1566248, "process_in_blocks": "111208", "process_kernel_time": 2.477988, "process_mem_max_rss": "119212", "process_out_blocks": "2800", "process_user_time": 3.47119}
[0m10:14:26.213233 [debug] [MainThread]: Command `dbt test` succeeded at 10:14:26.213090 after 3.16 seconds
[0m10:14:26.213617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbe8c0f13d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbe89be3650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbe8c7f9d60>]}
[0m10:14:26.213959 [debug] [MainThread]: Flushing usage events
[0m10:19:48.853630 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7c841f3110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7c83088fb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7c834a23f0>]}


============================== 10:19:48.868548 | 8f238c3d-0d36-4a37-912e-6636ffe833c4 ==============================
[0m10:19:48.868548 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:19:48.869307 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/woong/.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt/stock_elt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt test', 'send_anonymous_usage_stats': 'True'}
[0m10:19:49.762708 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8f238c3d-0d36-4a37-912e-6636ffe833c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7c819b0ce0>]}
[0m10:19:49.822456 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8f238c3d-0d36-4a37-912e-6636ffe833c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7c82176060>]}
[0m10:19:49.824015 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m10:19:49.908712 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m10:19:50.067819 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m10:19:50.068517 [debug] [MainThread]: Partial parsing: added file: stock_elt://models/schema.yml
[0m10:19:50.120029 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m10:19:50.120572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '8f238c3d-0d36-4a37-912e-6636ffe833c4', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7c81b74f50>]}
[0m10:19:50.346636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8f238c3d-0d36-4a37-912e-6636ffe833c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7c8163faa0>]}
[0m10:19:50.521563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8f238c3d-0d36-4a37-912e-6636ffe833c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7c812a5ca0>]}
[0m10:19:50.522165 [info ] [MainThread]: Found 2 models, 1 test, 1 source, 459 macros
[0m10:19:50.522523 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8f238c3d-0d36-4a37-912e-6636ffe833c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7c815de900>]}
[0m10:19:50.525550 [info ] [MainThread]: 
[0m10:19:50.526562 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:19:50.528606 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_Stock_Watcher_analytics_analytics'
[0m10:19:50.546504 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher_analytics_analytics"
[0m10:19:50.546919 [debug] [ThreadPool]: On list_Stock_Watcher_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "list_Stock_Watcher_analytics_analytics"} */
show objects in Stock_Watcher.analytics_analytics limit 10000
[0m10:19:50.547163 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:19:51.640438 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01b8a9af-0004-40d3-0002-10d3000adbde
[0m10:19:51.641164 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m10:19:51.641706 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m10:19:51.642033 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m10:19:51.642307 [debug] [ThreadPool]: On list_Stock_Watcher_analytics_analytics: Close
[0m10:19:51.961272 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8f238c3d-0d36-4a37-912e-6636ffe833c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7c809c2fc0>]}
[0m10:19:51.962237 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:19:51.962801 [info ] [MainThread]: 
[0m10:19:51.971033 [debug] [Thread-1 (]: Began running node test.stock_elt.not_null_foreign_stock_change_rate_conditions_symbol.692d2684ef
[0m10:19:51.971593 [info ] [Thread-1 (]: 1 of 1 START test not_null_foreign_stock_change_rate_conditions_symbol ......... [RUN]
[0m10:19:51.972073 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_Stock_Watcher_analytics_analytics, now test.stock_elt.not_null_foreign_stock_change_rate_conditions_symbol.692d2684ef)
[0m10:19:51.972505 [debug] [Thread-1 (]: Began compiling node test.stock_elt.not_null_foreign_stock_change_rate_conditions_symbol.692d2684ef
[0m10:19:51.990463 [debug] [Thread-1 (]: Writing injected SQL for node "test.stock_elt.not_null_foreign_stock_change_rate_conditions_symbol.692d2684ef"
[0m10:19:51.994668 [debug] [Thread-1 (]: Began executing node test.stock_elt.not_null_foreign_stock_change_rate_conditions_symbol.692d2684ef
[0m10:19:52.016492 [debug] [Thread-1 (]: Writing runtime sql for node "test.stock_elt.not_null_foreign_stock_change_rate_conditions_symbol.692d2684ef"
[0m10:19:52.020869 [debug] [Thread-1 (]: Using snowflake connection "test.stock_elt.not_null_foreign_stock_change_rate_conditions_symbol.692d2684ef"
[0m10:19:52.021652 [debug] [Thread-1 (]: On test.stock_elt.not_null_foreign_stock_change_rate_conditions_symbol.692d2684ef: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "node_id": "test.stock_elt.not_null_foreign_stock_change_rate_conditions_symbol.692d2684ef"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from Stock_Watcher.analytics_analytics.foreign_stock_change_rate_conditions
where symbol is null



      
    ) dbt_internal_test
[0m10:19:52.022054 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:19:53.018685 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b8a9af-0004-416a-0002-10d3000ae1d6
[0m10:19:53.019355 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (02000): SQL compilation error:
Schema 'STOCK_WATCHER.ANALYTICS_ANALYTICS' does not exist or not authorized.
[0m10:19:53.020191 [debug] [Thread-1 (]: On test.stock_elt.not_null_foreign_stock_change_rate_conditions_symbol.692d2684ef: Close
[0m10:19:53.381939 [debug] [Thread-1 (]: Database Error in test not_null_foreign_stock_change_rate_conditions_symbol (models/schema.yml)
  002003 (02000): SQL compilation error:
  Schema 'STOCK_WATCHER.ANALYTICS_ANALYTICS' does not exist or not authorized.
  compiled code at target/run/stock_elt/models/schema.yml/not_null_foreign_stock_change_rate_conditions_symbol.sql
[0m10:19:53.382556 [error] [Thread-1 (]: 1 of 1 ERROR not_null_foreign_stock_change_rate_conditions_symbol .............. [[31mERROR[0m in 1.41s]
[0m10:19:53.383415 [debug] [Thread-1 (]: Finished running node test.stock_elt.not_null_foreign_stock_change_rate_conditions_symbol.692d2684ef
[0m10:19:53.386632 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:19:53.387012 [debug] [MainThread]: Connection 'test.stock_elt.not_null_foreign_stock_change_rate_conditions_symbol.692d2684ef' was properly closed.
[0m10:19:53.387312 [info ] [MainThread]: 
[0m10:19:53.387628 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 2.86 seconds (2.86s).
[0m10:19:53.388266 [debug] [MainThread]: Command end result
[0m10:19:53.495044 [info ] [MainThread]: 
[0m10:19:53.495751 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:19:53.496178 [info ] [MainThread]: 
[0m10:19:53.496678 [error] [MainThread]:   Database Error in test not_null_foreign_stock_change_rate_conditions_symbol (models/schema.yml)
  002003 (02000): SQL compilation error:
  Schema 'STOCK_WATCHER.ANALYTICS_ANALYTICS' does not exist or not authorized.
  compiled code at target/run/stock_elt/models/schema.yml/not_null_foreign_stock_change_rate_conditions_symbol.sql
[0m10:19:53.497004 [info ] [MainThread]: 
[0m10:19:53.497291 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m10:19:53.501393 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": false, "command_wall_clock_time": 4.707464, "process_in_blocks": "113152", "process_kernel_time": 1.081091, "process_mem_max_rss": "130328", "process_out_blocks": "2848", "process_user_time": 2.642668}
[0m10:19:53.501967 [debug] [MainThread]: Command `dbt test` failed at 10:19:53.501864 after 4.71 seconds
[0m10:19:53.502253 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7c8671b350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7c839710a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7c83970740>]}
[0m10:19:53.502533 [debug] [MainThread]: Flushing usage events
[0m10:19:58.983012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffa4ff730b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffa4e067470>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffa4df882c0>]}


============================== 10:19:58.985863 | 1d9f122c-01fb-4a76-9578-327cdc47e9ed ==============================
[0m10:19:58.985863 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:19:58.986315 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt/stock_elt/logs', 'version_check': 'True', 'profiles_dir': '/home/woong/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:19:59.302402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1d9f122c-01fb-4a76-9578-327cdc47e9ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffa4c659c10>]}
[0m10:19:59.353397 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1d9f122c-01fb-4a76-9578-327cdc47e9ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffa4c630e60>]}
[0m10:19:59.354062 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m10:19:59.417162 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m10:19:59.541925 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:19:59.542271 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:19:59.578688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1d9f122c-01fb-4a76-9578-327cdc47e9ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffa4c5a1a30>]}
[0m10:19:59.677705 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1d9f122c-01fb-4a76-9578-327cdc47e9ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffa4c2a5d30>]}
[0m10:19:59.678472 [info ] [MainThread]: Found 2 models, 1 test, 1 source, 459 macros
[0m10:19:59.679108 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1d9f122c-01fb-4a76-9578-327cdc47e9ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffa4c5a3cb0>]}
[0m10:19:59.682334 [info ] [MainThread]: 
[0m10:19:59.683779 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:19:59.685529 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_Stock_Watcher'
[0m10:19:59.711320 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher"
[0m10:19:59.711899 [debug] [ThreadPool]: On list_Stock_Watcher: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "list_Stock_Watcher"} */
show terse schemas in database Stock_Watcher
    limit 10000
[0m10:19:59.712706 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:20:00.873918 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 1.161 seconds
[0m10:20:00.875287 [debug] [ThreadPool]: On list_Stock_Watcher: Close
[0m10:20:01.191465 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_Stock_Watcher, now create_Stock_Watcher_analytics_analytics)
[0m10:20:01.192264 [debug] [ThreadPool]: Creating schema "database: "Stock_Watcher"
schema: "analytics_analytics"
"
[0m10:20:01.199742 [debug] [ThreadPool]: Using snowflake connection "create_Stock_Watcher_analytics_analytics"
[0m10:20:01.200180 [debug] [ThreadPool]: On create_Stock_Watcher_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "create_Stock_Watcher_analytics_analytics"} */
create schema if not exists Stock_Watcher.analytics_analytics
[0m10:20:01.200409 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:20:02.106046 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.906 seconds
[0m10:20:02.107135 [debug] [ThreadPool]: On create_Stock_Watcher_analytics_analytics: Close
[0m10:20:02.436970 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_Stock_Watcher_analytics_analytics'
[0m10:20:02.449892 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher_analytics_analytics"
[0m10:20:02.450669 [debug] [ThreadPool]: On list_Stock_Watcher_analytics_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "list_Stock_Watcher_analytics_analytics"} */
show objects in Stock_Watcher.analytics_analytics limit 10000
[0m10:20:02.451050 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:20:03.320280 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.869 seconds
[0m10:20:03.322144 [debug] [ThreadPool]: On list_Stock_Watcher_analytics_analytics: Close
[0m10:20:03.679615 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1d9f122c-01fb-4a76-9578-327cdc47e9ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffa4c92d670>]}
[0m10:20:03.681109 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:20:03.682202 [info ] [MainThread]: 
[0m10:20:03.686588 [debug] [Thread-1 (]: Began running node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m10:20:03.688137 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_Stock_Watcher_analytics_analytics, now model.stock_elt.src_foreign_stock_change_rate_conditions)
[0m10:20:03.688765 [debug] [Thread-1 (]: Began compiling node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m10:20:03.697654 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_elt.src_foreign_stock_change_rate_conditions"
[0m10:20:03.701912 [debug] [Thread-1 (]: Finished running node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m10:20:03.703638 [debug] [Thread-1 (]: Began running node model.stock_elt.foreign_stock_change_rate_conditions
[0m10:20:03.704979 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics_analytics.foreign_stock_change_rate_conditions  [RUN]
[0m10:20:03.706074 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.stock_elt.src_foreign_stock_change_rate_conditions, now model.stock_elt.foreign_stock_change_rate_conditions)
[0m10:20:03.706458 [debug] [Thread-1 (]: Began compiling node model.stock_elt.foreign_stock_change_rate_conditions
[0m10:20:03.752246 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_elt.foreign_stock_change_rate_conditions"
[0m10:20:03.754371 [debug] [Thread-1 (]: Began executing node model.stock_elt.foreign_stock_change_rate_conditions
[0m10:20:03.787066 [debug] [Thread-1 (]: Writing runtime sql for node "model.stock_elt.foreign_stock_change_rate_conditions"
[0m10:20:03.793725 [debug] [Thread-1 (]: Using snowflake connection "model.stock_elt.foreign_stock_change_rate_conditions"
[0m10:20:03.794376 [debug] [Thread-1 (]: On model.stock_elt.foreign_stock_change_rate_conditions: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "node_id": "model.stock_elt.foreign_stock_change_rate_conditions"} */
create or replace transient table Stock_Watcher.analytics_analytics.foreign_stock_change_rate_conditions
         as
        (WITH  __dbt__cte__src_foreign_stock_change_rate_conditions as (
WITH src_foreign_stock_info_complete AS ( 
 SELECT * FROM Stock_Watcher.raw_data.foreign_stock_info_complete
)
SELECT NAME
     , FULLNAME 
     , DATE 
     , "Close" 
 FROM src_foreign_stock_info_complete
), ranked_data AS (
    SELECT *,
        ("Close" - LAG("Close") OVER (PARTITION BY name, fullname ORDER BY date)) / LAG("Close") OVER (PARTITION BY name, fullname ORDER BY date) * 100 AS change,
       -- 한 시간 변화율 계산
        (LEAD("Close", 1) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS hour_change,
        -- 하루 변화율 계산
        (LEAD("Close", 9) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS i_day_change_mean,
        
        -- 3일 변화율 계산
        (LEAD("Close", 27) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS three_day_change,
        
        -- 일주일 변화율 계산
        (LEAD("Close", 45) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS weekly_change
    FROM __dbt__cte__src_foreign_stock_change_rate_conditions
),
aggregated_data AS (
    SELECT
        CASE
            WHEN change > 10 THEN 'Change > 10'
            WHEN change > 5 THEN 'Change > 5'
            WHEN change <= -10 THEN 'Change <= -10'
            WHEN change <= -5 THEN 'Change <= -5'
            ELSE 'Other'
        END AS condition,
        AVG(hour_change) AS hour_change_mean,
        AVG(i_day_change_mean) AS i_day_change_mean,
        AVG(three_day_change) AS three_day_change_mean,
        AVG(weekly_change) AS weekly_change_mean,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY hour_change) AS hour_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY i_day_change_mean) AS i_day_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY three_day_change) AS three_day_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY weekly_change) AS weekly_change_median
    FROM ranked_data
    WHERE change > 5 OR change <= -5
    GROUP BY condition
)

-- mean값
SELECT 
    'hour_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN hour_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN hour_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN hour_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN hour_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'i_day_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN i_day_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN i_day_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN i_day_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN i_day_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'three_day_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN three_day_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN three_day_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN three_day_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN three_day_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'weekly_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN weekly_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN weekly_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN weekly_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN weekly_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

-- median값
UNION ALL

SELECT 
    'hour_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN hour_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN hour_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN hour_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN hour_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'i_day_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN i_day_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN i_day_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN i_day_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN i_day_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'three_day_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN three_day_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN three_day_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN three_day_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN three_day_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'weekly_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN weekly_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN weekly_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN weekly_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN weekly_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric
        );
[0m10:20:03.794997 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:20:06.578131 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.783 seconds
[0m10:20:06.600500 [debug] [Thread-1 (]: On model.stock_elt.foreign_stock_change_rate_conditions: Close
[0m10:20:06.897654 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1d9f122c-01fb-4a76-9578-327cdc47e9ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffa4c630920>]}
[0m10:20:06.898350 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics_analytics.foreign_stock_change_rate_conditions  [[32mSUCCESS 1[0m in 3.19s]
[0m10:20:06.898952 [debug] [Thread-1 (]: Finished running node model.stock_elt.foreign_stock_change_rate_conditions
[0m10:20:06.900883 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:20:06.901343 [debug] [MainThread]: Connection 'create_Stock_Watcher_analytics_analytics' was properly closed.
[0m10:20:06.901559 [debug] [MainThread]: Connection 'model.stock_elt.foreign_stock_change_rate_conditions' was properly closed.
[0m10:20:06.901862 [info ] [MainThread]: 
[0m10:20:06.902165 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 7.22 seconds (7.22s).
[0m10:20:06.902786 [debug] [MainThread]: Command end result
[0m10:20:06.931162 [info ] [MainThread]: 
[0m10:20:06.931830 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:20:06.932186 [info ] [MainThread]: 
[0m10:20:06.932473 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m10:20:06.933147 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.964763, "process_in_blocks": "288", "process_kernel_time": 0.162448, "process_mem_max_rss": "124900", "process_out_blocks": "1976", "process_user_time": 2.223511}
[0m10:20:06.933554 [debug] [MainThread]: Command `dbt run` succeeded at 10:20:06.933474 after 7.97 seconds
[0m10:20:06.933852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffa4dd3fe60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffa4c5a2f00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ffa4df882c0>]}
[0m10:20:06.934148 [debug] [MainThread]: Flushing usage events
[0m10:20:41.113015 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe1dbcae570>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe1dad3c980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe1db842570>]}


============================== 10:20:41.117177 | 92a71236-908c-43cf-9fd5-8b768dd45846 ==============================
[0m10:20:41.117177 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:20:41.117721 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/woong/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt/stock_elt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m10:20:41.465073 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '92a71236-908c-43cf-9fd5-8b768dd45846', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe1d96887d0>]}
[0m10:20:41.520889 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '92a71236-908c-43cf-9fd5-8b768dd45846', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe1d98ce360>]}
[0m10:20:41.521600 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m10:20:41.586855 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m10:20:41.690963 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m10:20:41.691590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '92a71236-908c-43cf-9fd5-8b768dd45846', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe1d9394c80>]}
[0m10:20:42.655571 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m10:20:42.656081 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '92a71236-908c-43cf-9fd5-8b768dd45846', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe1d926b020>]}
[0m10:20:42.927124 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '92a71236-908c-43cf-9fd5-8b768dd45846', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe1d81a0770>]}
[0m10:20:43.011813 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '92a71236-908c-43cf-9fd5-8b768dd45846', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe1d81c11f0>]}
[0m10:20:43.012323 [info ] [MainThread]: Found 2 models, 1 test, 1 source, 459 macros
[0m10:20:43.012766 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '92a71236-908c-43cf-9fd5-8b768dd45846', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe1d93e6cc0>]}
[0m10:20:43.014885 [info ] [MainThread]: 
[0m10:20:43.015557 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:20:43.018574 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_Stock_Watcher'
[0m10:20:43.033231 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher"
[0m10:20:43.033634 [debug] [ThreadPool]: On list_Stock_Watcher: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "list_Stock_Watcher"} */
show terse schemas in database Stock_Watcher
    limit 10000
[0m10:20:43.033853 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:20:44.095174 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.061 seconds
[0m10:20:44.097069 [debug] [ThreadPool]: On list_Stock_Watcher: Close
[0m10:20:44.408248 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_Stock_Watcher_analytics'
[0m10:20:44.416223 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher_analytics"
[0m10:20:44.416644 [debug] [ThreadPool]: On list_Stock_Watcher_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "list_Stock_Watcher_analytics"} */
show objects in Stock_Watcher.analytics limit 10000
[0m10:20:44.416875 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:20:45.331052 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.914 seconds
[0m10:20:45.332534 [debug] [ThreadPool]: On list_Stock_Watcher_analytics: Close
[0m10:20:45.645175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '92a71236-908c-43cf-9fd5-8b768dd45846', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe1d9533fe0>]}
[0m10:20:45.646149 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:20:45.646731 [info ] [MainThread]: 
[0m10:20:45.650292 [debug] [Thread-1 (]: Began running node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m10:20:45.650937 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_Stock_Watcher_analytics, now model.stock_elt.src_foreign_stock_change_rate_conditions)
[0m10:20:45.651310 [debug] [Thread-1 (]: Began compiling node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m10:20:45.658649 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_elt.src_foreign_stock_change_rate_conditions"
[0m10:20:45.660163 [debug] [Thread-1 (]: Finished running node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m10:20:45.661834 [debug] [Thread-1 (]: Began running node model.stock_elt.foreign_stock_change_rate_conditions
[0m10:20:45.662499 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.foreign_stock_change_rate_conditions .... [RUN]
[0m10:20:45.663090 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.stock_elt.src_foreign_stock_change_rate_conditions, now model.stock_elt.foreign_stock_change_rate_conditions)
[0m10:20:45.663423 [debug] [Thread-1 (]: Began compiling node model.stock_elt.foreign_stock_change_rate_conditions
[0m10:20:45.720134 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_elt.foreign_stock_change_rate_conditions"
[0m10:20:45.720881 [debug] [Thread-1 (]: Began executing node model.stock_elt.foreign_stock_change_rate_conditions
[0m10:20:45.751403 [debug] [Thread-1 (]: Writing runtime sql for node "model.stock_elt.foreign_stock_change_rate_conditions"
[0m10:20:45.756485 [debug] [Thread-1 (]: Using snowflake connection "model.stock_elt.foreign_stock_change_rate_conditions"
[0m10:20:45.757043 [debug] [Thread-1 (]: On model.stock_elt.foreign_stock_change_rate_conditions: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "node_id": "model.stock_elt.foreign_stock_change_rate_conditions"} */
create or replace transient table Stock_Watcher.analytics.foreign_stock_change_rate_conditions
         as
        (WITH  __dbt__cte__src_foreign_stock_change_rate_conditions as (
WITH src_foreign_stock_info_complete AS ( 
 SELECT * FROM Stock_Watcher.raw_data.foreign_stock_info_complete
)
SELECT NAME
     , FULLNAME 
     , DATE 
     , "Close" 
 FROM src_foreign_stock_info_complete
), ranked_data AS (
    SELECT *,
        ("Close" - LAG("Close") OVER (PARTITION BY name, fullname ORDER BY date)) / LAG("Close") OVER (PARTITION BY name, fullname ORDER BY date) * 100 AS change,
       -- 한 시간 변화율 계산
        (LEAD("Close", 1) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS hour_change,
        -- 하루 변화율 계산
        (LEAD("Close", 9) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS i_day_change_mean,
        
        -- 3일 변화율 계산
        (LEAD("Close", 27) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS three_day_change,
        
        -- 일주일 변화율 계산
        (LEAD("Close", 45) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS weekly_change
    FROM __dbt__cte__src_foreign_stock_change_rate_conditions
),
aggregated_data AS (
    SELECT
        CASE
            WHEN change > 10 THEN 'Change > 10'
            WHEN change > 5 THEN 'Change > 5'
            WHEN change <= -10 THEN 'Change <= -10'
            WHEN change <= -5 THEN 'Change <= -5'
            ELSE 'Other'
        END AS condition,
        AVG(hour_change) AS hour_change_mean,
        AVG(i_day_change_mean) AS i_day_change_mean,
        AVG(three_day_change) AS three_day_change_mean,
        AVG(weekly_change) AS weekly_change_mean,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY hour_change) AS hour_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY i_day_change_mean) AS i_day_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY three_day_change) AS three_day_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY weekly_change) AS weekly_change_median
    FROM ranked_data
    WHERE change > 5 OR change <= -5
    GROUP BY condition
)

-- mean값
SELECT 
    'hour_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN hour_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN hour_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN hour_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN hour_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'i_day_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN i_day_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN i_day_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN i_day_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN i_day_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'three_day_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN three_day_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN three_day_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN three_day_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN three_day_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'weekly_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN weekly_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN weekly_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN weekly_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN weekly_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

-- median값
UNION ALL

SELECT 
    'hour_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN hour_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN hour_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN hour_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN hour_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'i_day_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN i_day_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN i_day_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN i_day_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN i_day_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'three_day_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN three_day_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN three_day_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN three_day_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN three_day_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'weekly_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN weekly_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN weekly_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN weekly_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN weekly_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric
        );
[0m10:20:45.757502 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:20:48.430515 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.673 seconds
[0m10:20:48.454295 [debug] [Thread-1 (]: On model.stock_elt.foreign_stock_change_rate_conditions: Close
[0m10:20:48.746061 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '92a71236-908c-43cf-9fd5-8b768dd45846', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe1bb6b83e0>]}
[0m10:20:48.747416 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.foreign_stock_change_rate_conditions  [[32mSUCCESS 1[0m in 3.08s]
[0m10:20:48.748357 [debug] [Thread-1 (]: Finished running node model.stock_elt.foreign_stock_change_rate_conditions
[0m10:20:48.751043 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:20:48.751625 [debug] [MainThread]: Connection 'list_Stock_Watcher' was properly closed.
[0m10:20:48.751992 [debug] [MainThread]: Connection 'model.stock_elt.foreign_stock_change_rate_conditions' was properly closed.
[0m10:20:48.752411 [info ] [MainThread]: 
[0m10:20:48.752742 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 5.74 seconds (5.74s).
[0m10:20:48.753577 [debug] [MainThread]: Command end result
[0m10:20:48.779457 [info ] [MainThread]: 
[0m10:20:48.779980 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:20:48.780291 [info ] [MainThread]: 
[0m10:20:48.780608 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m10:20:48.781285 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.72277, "process_in_blocks": "480", "process_kernel_time": 0.168748, "process_mem_max_rss": "129860", "process_out_blocks": "2920", "process_user_time": 3.374961}
[0m10:20:48.781967 [debug] [MainThread]: Command `dbt run` succeeded at 10:20:48.781831 after 7.72 seconds
[0m10:20:48.782398 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe1dd0b0d70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe1dad85730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe1dad85640>]}
[0m10:20:48.782848 [debug] [MainThread]: Flushing usage events
[0m10:24:54.730394 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3386336540>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3384380920>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f338431fe30>]}


============================== 10:24:54.739078 | 2bee1d65-df6b-4bef-aa99-c92295e1f97f ==============================
[0m10:24:54.739078 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:24:54.740092 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt/stock_elt/logs', 'debug': 'False', 'profiles_dir': '/home/woong/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:24:55.377475 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2bee1d65-df6b-4bef-aa99-c92295e1f97f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3382a7d4f0>]}
[0m10:24:55.426999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2bee1d65-df6b-4bef-aa99-c92295e1f97f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3384698da0>]}
[0m10:24:55.428800 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m10:24:55.512613 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m10:24:55.740020 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:24:55.740405 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:24:55.777354 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2bee1d65-df6b-4bef-aa99-c92295e1f97f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f338298fe90>]}
[0m10:24:55.938155 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2bee1d65-df6b-4bef-aa99-c92295e1f97f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f338246c590>]}
[0m10:24:55.938596 [info ] [MainThread]: Found 2 models, 1 test, 1 source, 459 macros
[0m10:24:55.939025 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2bee1d65-df6b-4bef-aa99-c92295e1f97f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3382611cd0>]}
[0m10:24:55.940705 [info ] [MainThread]: 
[0m10:24:55.941506 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:24:55.942945 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_Stock_Watcher_analytics'
[0m10:24:55.959518 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher_analytics"
[0m10:24:55.959985 [debug] [ThreadPool]: On list_Stock_Watcher_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "list_Stock_Watcher_analytics"} */
show objects in Stock_Watcher.analytics limit 10000
[0m10:24:55.960248 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:24:57.086590 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.126 seconds
[0m10:24:57.088310 [debug] [ThreadPool]: On list_Stock_Watcher_analytics: Close
[0m10:24:57.435495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2bee1d65-df6b-4bef-aa99-c92295e1f97f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3382a7f200>]}
[0m10:24:57.436054 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:24:57.436342 [info ] [MainThread]: 
[0m10:24:57.442512 [debug] [Thread-1 (]: Began running node test.stock_elt.not_null_foreign_stock_change_rate_conditions_symbol.692d2684ef
[0m10:24:57.443031 [info ] [Thread-1 (]: 1 of 1 START test not_null_foreign_stock_change_rate_conditions_symbol ......... [RUN]
[0m10:24:57.443468 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_Stock_Watcher_analytics, now test.stock_elt.not_null_foreign_stock_change_rate_conditions_symbol.692d2684ef)
[0m10:24:57.443796 [debug] [Thread-1 (]: Began compiling node test.stock_elt.not_null_foreign_stock_change_rate_conditions_symbol.692d2684ef
[0m10:24:57.462951 [debug] [Thread-1 (]: Writing injected SQL for node "test.stock_elt.not_null_foreign_stock_change_rate_conditions_symbol.692d2684ef"
[0m10:24:57.464540 [debug] [Thread-1 (]: Began executing node test.stock_elt.not_null_foreign_stock_change_rate_conditions_symbol.692d2684ef
[0m10:24:57.483491 [debug] [Thread-1 (]: Writing runtime sql for node "test.stock_elt.not_null_foreign_stock_change_rate_conditions_symbol.692d2684ef"
[0m10:24:57.484725 [debug] [Thread-1 (]: Using snowflake connection "test.stock_elt.not_null_foreign_stock_change_rate_conditions_symbol.692d2684ef"
[0m10:24:57.485078 [debug] [Thread-1 (]: On test.stock_elt.not_null_foreign_stock_change_rate_conditions_symbol.692d2684ef: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "node_id": "test.stock_elt.not_null_foreign_stock_change_rate_conditions_symbol.692d2684ef"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from Stock_Watcher.analytics.foreign_stock_change_rate_conditions
where symbol is null



      
    ) dbt_internal_test
[0m10:24:57.485376 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:24:58.341092 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b8a9b4-0004-416a-0002-10d3000ae29a
[0m10:24:58.341620 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 12 at position 7
invalid identifier 'SYMBOL'
[0m10:24:58.342065 [debug] [Thread-1 (]: On test.stock_elt.not_null_foreign_stock_change_rate_conditions_symbol.692d2684ef: Close
[0m10:24:58.781383 [debug] [Thread-1 (]: Database Error in test not_null_foreign_stock_change_rate_conditions_symbol (models/schema.yml)
  000904 (42000): SQL compilation error: error line 12 at position 7
  invalid identifier 'SYMBOL'
  compiled code at target/run/stock_elt/models/schema.yml/not_null_foreign_stock_change_rate_conditions_symbol.sql
[0m10:24:58.782170 [error] [Thread-1 (]: 1 of 1 ERROR not_null_foreign_stock_change_rate_conditions_symbol .............. [[31mERROR[0m in 1.34s]
[0m10:24:58.783051 [debug] [Thread-1 (]: Finished running node test.stock_elt.not_null_foreign_stock_change_rate_conditions_symbol.692d2684ef
[0m10:24:58.786667 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:24:58.787320 [debug] [MainThread]: Connection 'test.stock_elt.not_null_foreign_stock_change_rate_conditions_symbol.692d2684ef' was properly closed.
[0m10:24:58.787755 [info ] [MainThread]: 
[0m10:24:58.788237 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 2.85 seconds (2.85s).
[0m10:24:58.789291 [debug] [MainThread]: Command end result
[0m10:24:58.834677 [info ] [MainThread]: 
[0m10:24:58.835421 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:24:58.836251 [info ] [MainThread]: 
[0m10:24:58.837040 [error] [MainThread]:   Database Error in test not_null_foreign_stock_change_rate_conditions_symbol (models/schema.yml)
  000904 (42000): SQL compilation error: error line 12 at position 7
  invalid identifier 'SYMBOL'
  compiled code at target/run/stock_elt/models/schema.yml/not_null_foreign_stock_change_rate_conditions_symbol.sql
[0m10:24:58.846682 [info ] [MainThread]: 
[0m10:24:58.847326 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m10:24:58.848483 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": false, "command_wall_clock_time": 4.167864, "process_in_blocks": "36480", "process_kernel_time": 0.363834, "process_mem_max_rss": "127192", "process_out_blocks": "1912", "process_user_time": 2.233542}
[0m10:24:58.849334 [debug] [MainThread]: Command `dbt test` failed at 10:24:58.849166 after 4.17 seconds
[0m10:24:58.849859 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3384680950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3384bfd430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3384bfd640>]}
[0m10:24:58.850348 [debug] [MainThread]: Flushing usage events
[0m10:27:03.947663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4850931d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb483ea88f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb483bce7b0>]}


============================== 10:27:03.956354 | 45323e1c-a4cd-412a-a421-4d3fbba77dd2 ==============================
[0m10:27:03.956354 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:27:03.957025 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/home/woong/.dbt', 'log_path': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt/stock_elt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt test', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m10:27:04.646936 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '45323e1c-a4cd-412a-a421-4d3fbba77dd2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4826371d0>]}
[0m10:27:04.700889 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '45323e1c-a4cd-412a-a421-4d3fbba77dd2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb48244f410>]}
[0m10:27:04.702146 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m10:27:04.785500 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m10:27:04.945118 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m10:27:04.945892 [debug] [MainThread]: Partial parsing: updated file: stock_elt://models/schema.yml
[0m10:27:05.183014 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m10:27:05.183672 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '45323e1c-a4cd-412a-a421-4d3fbba77dd2', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4820fe1b0>]}
[0m10:27:05.376226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '45323e1c-a4cd-412a-a421-4d3fbba77dd2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb48233d700>]}
[0m10:27:05.530636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '45323e1c-a4cd-412a-a421-4d3fbba77dd2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb480b12390>]}
[0m10:27:05.531408 [info ] [MainThread]: Found 2 models, 1 test, 1 source, 459 macros
[0m10:27:05.531954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '45323e1c-a4cd-412a-a421-4d3fbba77dd2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb481eda9f0>]}
[0m10:27:05.533872 [info ] [MainThread]: 
[0m10:27:05.534642 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:27:05.537485 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_Stock_Watcher_analytics'
[0m10:27:05.556804 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher_analytics"
[0m10:27:05.557270 [debug] [ThreadPool]: On list_Stock_Watcher_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "list_Stock_Watcher_analytics"} */
show objects in Stock_Watcher.analytics limit 10000
[0m10:27:05.557547 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:27:06.744395 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.187 seconds
[0m10:27:06.745991 [debug] [ThreadPool]: On list_Stock_Watcher_analytics: Close
[0m10:27:07.031215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '45323e1c-a4cd-412a-a421-4d3fbba77dd2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb480df5370>]}
[0m10:27:07.031811 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:27:07.032136 [info ] [MainThread]: 
[0m10:27:07.038064 [debug] [Thread-1 (]: Began running node test.stock_elt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08
[0m10:27:07.038617 [info ] [Thread-1 (]: 1 of 1 START test not_null_foreign_stock_change_rate_conditions_METRIC ......... [RUN]
[0m10:27:07.039282 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_Stock_Watcher_analytics, now test.stock_elt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08)
[0m10:27:07.039623 [debug] [Thread-1 (]: Began compiling node test.stock_elt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08
[0m10:27:07.058563 [debug] [Thread-1 (]: Writing injected SQL for node "test.stock_elt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08"
[0m10:27:07.061371 [debug] [Thread-1 (]: Began executing node test.stock_elt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08
[0m10:27:07.079299 [debug] [Thread-1 (]: Writing runtime sql for node "test.stock_elt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08"
[0m10:27:07.080967 [debug] [Thread-1 (]: Using snowflake connection "test.stock_elt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08"
[0m10:27:07.081434 [debug] [Thread-1 (]: On test.stock_elt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "node_id": "test.stock_elt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select METRIC
from Stock_Watcher.analytics.foreign_stock_change_rate_conditions
where METRIC is null



      
    ) dbt_internal_test
[0m10:27:07.081689 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:27:08.005673 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.924 seconds
[0m10:27:08.017637 [debug] [Thread-1 (]: On test.stock_elt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08: Close
[0m10:27:08.315435 [info ] [Thread-1 (]: 1 of 1 PASS not_null_foreign_stock_change_rate_conditions_METRIC ............... [[32mPASS[0m in 1.28s]
[0m10:27:08.316173 [debug] [Thread-1 (]: Finished running node test.stock_elt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08
[0m10:27:08.317966 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:27:08.318307 [debug] [MainThread]: Connection 'test.stock_elt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08' was properly closed.
[0m10:27:08.318545 [info ] [MainThread]: 
[0m10:27:08.318867 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 2.78 seconds (2.78s).
[0m10:27:08.319477 [debug] [MainThread]: Command end result
[0m10:27:08.344460 [info ] [MainThread]: 
[0m10:27:08.345001 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:27:08.345297 [info ] [MainThread]: 
[0m10:27:08.345579 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m10:27:08.347333 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 4.460503, "process_in_blocks": "111608", "process_kernel_time": 0.753303, "process_mem_max_rss": "129908", "process_out_blocks": "2840", "process_user_time": 2.775326}
[0m10:27:08.348105 [debug] [MainThread]: Command `dbt test` succeeded at 10:27:08.347987 after 4.46 seconds
[0m10:27:08.348421 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb487027380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb484b38980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4822f7890>]}
[0m10:27:08.348703 [debug] [MainThread]: Flushing usage events
[0m10:41:57.654241 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7febc00b1520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7febc12373b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7febc00233b0>]}


============================== 10:41:57.673936 | 909f2e51-a070-4602-b151-6be5379bd658 ==============================
[0m10:41:57.673936 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:41:57.674491 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt/logs', 'profiles_dir': '/home/woong/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m10:41:58.729107 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '909f2e51-a070-4602-b151-6be5379bd658', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7febbea43b90>]}
[0m10:41:58.787388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '909f2e51-a070-4602-b151-6be5379bd658', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7febbea297c0>]}
[0m10:41:58.788740 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m10:41:58.889060 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m10:41:59.157954 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:41:59.158338 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:41:59.213221 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '909f2e51-a070-4602-b151-6be5379bd658', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7febc2270290>]}
[0m10:41:59.407365 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '909f2e51-a070-4602-b151-6be5379bd658', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7febbe5f9c10>]}
[0m10:41:59.407925 [info ] [MainThread]: Found 2 models, 1 test, 1 source, 459 macros
[0m10:41:59.408282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '909f2e51-a070-4602-b151-6be5379bd658', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7febbfdf0bf0>]}
[0m10:41:59.411176 [info ] [MainThread]: 
[0m10:41:59.412668 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:41:59.414774 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_Stock_Watcher'
[0m10:41:59.443056 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher"
[0m10:41:59.443454 [debug] [ThreadPool]: On list_Stock_Watcher: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "list_Stock_Watcher"} */
show terse schemas in database Stock_Watcher
    limit 10000
[0m10:41:59.443988 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:42:00.685952 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 1.242 seconds
[0m10:42:00.687670 [debug] [ThreadPool]: On list_Stock_Watcher: Close
[0m10:42:00.976133 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_Stock_Watcher_analytics'
[0m10:42:00.984015 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher_analytics"
[0m10:42:00.984403 [debug] [ThreadPool]: On list_Stock_Watcher_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "list_Stock_Watcher_analytics"} */
show objects in Stock_Watcher.analytics limit 10000
[0m10:42:00.984619 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:42:01.886870 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.902 seconds
[0m10:42:01.889123 [debug] [ThreadPool]: On list_Stock_Watcher_analytics: Close
[0m10:42:02.226339 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '909f2e51-a070-4602-b151-6be5379bd658', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7febbe4e7320>]}
[0m10:42:02.226952 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:42:02.227327 [info ] [MainThread]: 
[0m10:42:02.235510 [debug] [Thread-1 (]: Began running node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m10:42:02.236454 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_Stock_Watcher_analytics, now model.stock_elt.src_foreign_stock_change_rate_conditions)
[0m10:42:02.236814 [debug] [Thread-1 (]: Began compiling node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m10:42:02.246994 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_elt.src_foreign_stock_change_rate_conditions"
[0m10:42:02.249255 [debug] [Thread-1 (]: Finished running node model.stock_elt.src_foreign_stock_change_rate_conditions
[0m10:42:02.251282 [debug] [Thread-1 (]: Began running node model.stock_elt.foreign_stock_change_rate_conditions
[0m10:42:02.252284 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.foreign_stock_change_rate_conditions .... [RUN]
[0m10:42:02.253060 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.stock_elt.src_foreign_stock_change_rate_conditions, now model.stock_elt.foreign_stock_change_rate_conditions)
[0m10:42:02.253636 [debug] [Thread-1 (]: Began compiling node model.stock_elt.foreign_stock_change_rate_conditions
[0m10:42:02.305279 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_elt.foreign_stock_change_rate_conditions"
[0m10:42:02.307788 [debug] [Thread-1 (]: Began executing node model.stock_elt.foreign_stock_change_rate_conditions
[0m10:42:02.341299 [debug] [Thread-1 (]: Writing runtime sql for node "model.stock_elt.foreign_stock_change_rate_conditions"
[0m10:42:02.349168 [debug] [Thread-1 (]: Using snowflake connection "model.stock_elt.foreign_stock_change_rate_conditions"
[0m10:42:02.349895 [debug] [Thread-1 (]: On model.stock_elt.foreign_stock_change_rate_conditions: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "node_id": "model.stock_elt.foreign_stock_change_rate_conditions"} */
create or replace transient table Stock_Watcher.analytics.foreign_stock_change_rate_conditions
         as
        (WITH  __dbt__cte__src_foreign_stock_change_rate_conditions as (
WITH src_foreign_stock_info_complete AS ( 
 SELECT * FROM Stock_Watcher.raw_data.foreign_stock_info_complete
)
SELECT NAME
     , FULLNAME 
     , DATE 
     , "Close" 
 FROM src_foreign_stock_info_complete
), ranked_data AS (
    SELECT *,
        ("Close" - LAG("Close") OVER (PARTITION BY name, fullname ORDER BY date)) / LAG("Close") OVER (PARTITION BY name, fullname ORDER BY date) * 100 AS change,
       -- 한 시간 변화율 계산
        (LEAD("Close", 1) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS hour_change,
        -- 하루 변화율 계산
        (LEAD("Close", 9) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS i_day_change_mean,
        
        -- 3일 변화율 계산
        (LEAD("Close", 27) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS three_day_change,
        
        -- 일주일 변화율 계산
        (LEAD("Close", 45) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS weekly_change
    FROM __dbt__cte__src_foreign_stock_change_rate_conditions
),
aggregated_data AS (
    SELECT
        CASE
            WHEN change > 10 THEN 'Change > 10'
            WHEN change > 5 THEN 'Change > 5'
            WHEN change <= -10 THEN 'Change <= -10'
            WHEN change <= -5 THEN 'Change <= -5'
            ELSE 'Other'
        END AS condition,
        AVG(hour_change) AS hour_change_mean,
        AVG(i_day_change_mean) AS i_day_change_mean,
        AVG(three_day_change) AS three_day_change_mean,
        AVG(weekly_change) AS weekly_change_mean,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY hour_change) AS hour_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY i_day_change_mean) AS i_day_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY three_day_change) AS three_day_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY weekly_change) AS weekly_change_median
    FROM ranked_data
    WHERE change > 5 OR change <= -5
    GROUP BY condition
)

-- mean값
SELECT 
    'hour_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN hour_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN hour_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN hour_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN hour_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'i_day_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN i_day_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN i_day_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN i_day_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN i_day_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'three_day_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN three_day_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN three_day_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN three_day_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN three_day_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'weekly_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN weekly_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN weekly_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN weekly_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN weekly_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

-- median값
UNION ALL

SELECT 
    'hour_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN hour_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN hour_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN hour_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN hour_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'i_day_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN i_day_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN i_day_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN i_day_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN i_day_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'three_day_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN three_day_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN three_day_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN three_day_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN three_day_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'weekly_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN weekly_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN weekly_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN weekly_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN weekly_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric
        );
[0m10:42:02.350836 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:42:05.076324 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.725 seconds
[0m10:42:05.115785 [debug] [Thread-1 (]: On model.stock_elt.foreign_stock_change_rate_conditions: Close
[0m10:42:05.485382 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '909f2e51-a070-4602-b151-6be5379bd658', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7febbe8c0950>]}
[0m10:42:05.485979 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.foreign_stock_change_rate_conditions  [[32mSUCCESS 1[0m in 3.23s]
[0m10:42:05.486780 [debug] [Thread-1 (]: Finished running node model.stock_elt.foreign_stock_change_rate_conditions
[0m10:42:05.489881 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:42:05.490860 [debug] [MainThread]: Connection 'list_Stock_Watcher' was properly closed.
[0m10:42:05.491661 [debug] [MainThread]: Connection 'model.stock_elt.foreign_stock_change_rate_conditions' was properly closed.
[0m10:42:05.492376 [info ] [MainThread]: 
[0m10:42:05.493136 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 6.08 seconds (6.08s).
[0m10:42:05.494033 [debug] [MainThread]: Command end result
[0m10:42:05.526213 [info ] [MainThread]: 
[0m10:42:05.526950 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:42:05.527456 [info ] [MainThread]: 
[0m10:42:05.527807 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m10:42:05.530783 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.9043665, "process_in_blocks": "107120", "process_kernel_time": 1.82966, "process_mem_max_rss": "126248", "process_out_blocks": "1976", "process_user_time": 2.709875}
[0m10:42:05.531358 [debug] [MainThread]: Command `dbt run` succeeded at 10:42:05.531257 after 7.91 seconds
[0m10:42:05.531667 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7febc0af95b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7febc0f7df70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7febbe8dc9b0>]}
[0m10:42:05.532283 [debug] [MainThread]: Flushing usage events
[0m10:42:10.850653 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcaabb09460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcaaa70fad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcaaa70fe00>]}


============================== 10:42:10.855362 | f078f2bd-8e00-4d2e-a41b-2aa967355963 ==============================
[0m10:42:10.855362 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:42:10.856261 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt/logs', 'profiles_dir': '/home/woong/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt test', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m10:42:11.206650 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f078f2bd-8e00-4d2e-a41b-2aa967355963', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcaa8b07b90>]}
[0m10:42:11.265917 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f078f2bd-8e00-4d2e-a41b-2aa967355963', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcaab1fa0f0>]}
[0m10:42:11.266627 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m10:42:11.331054 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m10:42:11.447823 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:42:11.448485 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:42:11.494200 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f078f2bd-8e00-4d2e-a41b-2aa967355963', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcaa898e8d0>]}
[0m10:42:11.604327 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f078f2bd-8e00-4d2e-a41b-2aa967355963', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcaa84746e0>]}
[0m10:42:11.604815 [info ] [MainThread]: Found 2 models, 1 test, 1 source, 459 macros
[0m10:42:11.605419 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f078f2bd-8e00-4d2e-a41b-2aa967355963', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcaa8642930>]}
[0m10:42:11.607789 [info ] [MainThread]: 
[0m10:42:11.609348 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:42:11.610938 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_Stock_Watcher_analytics'
[0m10:42:11.627056 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher_analytics"
[0m10:42:11.628102 [debug] [ThreadPool]: On list_Stock_Watcher_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "connection_name": "list_Stock_Watcher_analytics"} */
show objects in Stock_Watcher.analytics limit 10000
[0m10:42:11.628372 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:42:12.576668 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.948 seconds
[0m10:42:12.580432 [debug] [ThreadPool]: On list_Stock_Watcher_analytics: Close
[0m10:42:12.858933 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f078f2bd-8e00-4d2e-a41b-2aa967355963', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcaa8982a50>]}
[0m10:42:12.859921 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:42:12.860572 [info ] [MainThread]: 
[0m10:42:12.863767 [debug] [Thread-1 (]: Began running node test.stock_elt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08
[0m10:42:12.864335 [info ] [Thread-1 (]: 1 of 1 START test not_null_foreign_stock_change_rate_conditions_METRIC ......... [RUN]
[0m10:42:12.865090 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_Stock_Watcher_analytics, now test.stock_elt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08)
[0m10:42:12.865567 [debug] [Thread-1 (]: Began compiling node test.stock_elt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08
[0m10:42:12.888248 [debug] [Thread-1 (]: Writing injected SQL for node "test.stock_elt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08"
[0m10:42:12.890099 [debug] [Thread-1 (]: Began executing node test.stock_elt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08
[0m10:42:12.909202 [debug] [Thread-1 (]: Writing runtime sql for node "test.stock_elt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08"
[0m10:42:12.911089 [debug] [Thread-1 (]: Using snowflake connection "test.stock_elt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08"
[0m10:42:12.911815 [debug] [Thread-1 (]: On test.stock_elt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_elt", "target_name": "dev", "node_id": "test.stock_elt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select METRIC
from Stock_Watcher.analytics.foreign_stock_change_rate_conditions
where METRIC is null



      
    ) dbt_internal_test
[0m10:42:12.912126 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:42:13.925236 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.013 seconds
[0m10:42:13.935873 [debug] [Thread-1 (]: On test.stock_elt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08: Close
[0m10:42:14.276981 [info ] [Thread-1 (]: 1 of 1 PASS not_null_foreign_stock_change_rate_conditions_METRIC ............... [[32mPASS[0m in 1.41s]
[0m10:42:14.277886 [debug] [Thread-1 (]: Finished running node test.stock_elt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08
[0m10:42:14.279893 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:42:14.280363 [debug] [MainThread]: Connection 'test.stock_elt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08' was properly closed.
[0m10:42:14.280701 [info ] [MainThread]: 
[0m10:42:14.281132 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 2.67 seconds (2.67s).
[0m10:42:14.282152 [debug] [MainThread]: Command end result
[0m10:42:14.309754 [info ] [MainThread]: 
[0m10:42:14.310416 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:42:14.310874 [info ] [MainThread]: 
[0m10:42:14.311223 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m10:42:14.312138 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.528044, "process_in_blocks": "2168", "process_kernel_time": 0.305282, "process_mem_max_rss": "126516", "process_out_blocks": "1896", "process_user_time": 2.235454}
[0m10:42:14.312651 [debug] [MainThread]: Command `dbt test` succeeded at 10:42:14.312531 after 3.53 seconds
[0m10:42:14.313002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcaad7f3350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcaaa1af500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcaa8f28830>]}
[0m10:42:14.313298 [debug] [MainThread]: Flushing usage events
[0m10:51:39.627304 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f50de183e00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f50e0028e30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f50de648800>]}


============================== 10:51:39.640404 | 4cc9e8b7-73bd-4d4b-a4dd-8338804b66a4 ==============================
[0m10:51:39.640404 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:51:39.641623 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt', 'log_path': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt test', 'send_anonymous_usage_stats': 'True'}
[0m10:51:39.651548 [error] [MainThread]: Encountered an error:
Parsing Error
  Env var required but not provided: 'DBT_ACCOUNT'
[0m10:51:39.653478 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": false, "command_wall_clock_time": 0.09291708, "process_in_blocks": "75192", "process_kernel_time": 0.977052, "process_mem_max_rss": "86460", "process_out_blocks": "16", "process_user_time": 1.603124}
[0m10:51:39.653917 [debug] [MainThread]: Command `dbt test` failed at 10:51:39.653834 after 0.09 seconds
[0m10:51:39.654234 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f50ded663f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f50ddef79e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f50de648800>]}
[0m10:51:39.654489 [debug] [MainThread]: Flushing usage events
[0m10:53:56.657915 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd4b2757f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd4be93c20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd4cbd36b0>]}


============================== 10:53:56.665036 | a2f60ae7-5b81-47e0-b7b5-d59152cb7d20 ==============================
[0m10:53:56.665036 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:53:56.665779 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:53:56.668416 [error] [MainThread]: Encountered an error:
Runtime Error
  Could not find profile named 'stock_elt'
[0m10:53:56.670051 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": false, "command_wall_clock_time": 0.061024915, "process_in_blocks": "74912", "process_kernel_time": 0.476863, "process_mem_max_rss": "86416", "process_out_blocks": "16", "process_user_time": 1.582782}
[0m10:53:56.670564 [debug] [MainThread]: Command `dbt test` failed at 10:53:56.670464 after 0.06 seconds
[0m10:53:56.670889 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd4b1454c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd4be93c20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efd4bdb9c40>]}
[0m10:53:56.671214 [debug] [MainThread]: Flushing usage events
[0m10:54:47.860803 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f53cb9d1e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f53cc32af90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f53cb9d09e0>]}


============================== 10:54:47.868054 | 1498bbd0-cd0e-4e7d-a3e3-3cba5b095a64 ==============================
[0m10:54:47.868054 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:54:47.869042 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt', 'log_path': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt test', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m10:54:47.872741 [error] [MainThread]: Encountered an error:
Runtime Error
  Could not find profile named 'stock_elt'
[0m10:54:47.874570 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": false, "command_wall_clock_time": 0.0776929, "process_in_blocks": "75312", "process_kernel_time": 0.169301, "process_mem_max_rss": "86628", "process_out_blocks": "8", "process_user_time": 1.344455}
[0m10:54:47.875222 [debug] [MainThread]: Command `dbt test` failed at 10:54:47.875111 after 0.08 seconds
[0m10:54:47.875534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f53ccd16930>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f53cbe3c4a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f53cb9d1df0>]}
[0m10:54:47.875864 [debug] [MainThread]: Flushing usage events
[0m10:55:19.218125 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c2f3a1fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c2dafd880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c2dd843b0>]}


============================== 10:55:19.222162 | 5f2814ae-75b0-46c8-8cfe-1d6d4a4caf77 ==============================
[0m10:55:19.222162 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:55:19.222678 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt/logs', 'debug': 'False', 'profiles_dir': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt test', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m10:55:19.225633 [error] [MainThread]: Encountered an error:
Runtime Error
  Could not find profile named 'stock_elt'
[0m10:55:19.226776 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": false, "command_wall_clock_time": 0.06404007, "process_in_blocks": "0", "process_kernel_time": 0.060306, "process_mem_max_rss": "87068", "process_out_blocks": "16", "process_user_time": 1.356894}
[0m10:55:19.227308 [debug] [MainThread]: Command `dbt test` failed at 10:55:19.227209 after 0.06 seconds
[0m10:55:19.227590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c2f3a1fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c2dd863f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6c2d705520>]}
[0m10:55:19.227861 [debug] [MainThread]: Flushing usage events
[0m10:56:37.073043 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc0395b06b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc0399c8800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc0395b0b90>]}


============================== 10:56:37.080785 | af4e101e-24ea-48e2-8434-e32bbee4efd9 ==============================
[0m10:56:37.080785 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:56:37.082015 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt test', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m10:56:37.909796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'af4e101e-24ea-48e2-8434-e32bbee4efd9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc03a637b30>]}
[0m10:56:37.962134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'af4e101e-24ea-48e2-8434-e32bbee4efd9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc038f8f380>]}
[0m10:56:37.964832 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m10:56:38.042818 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m10:56:38.147961 [info ] [MainThread]: Unable to do partial parsing because a project dependency has been added
[0m10:56:38.148928 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'af4e101e-24ea-48e2-8434-e32bbee4efd9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc037674980>]}
[0m10:56:39.208844 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m10:56:39.209773 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'af4e101e-24ea-48e2-8434-e32bbee4efd9', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc037791df0>]}
[0m10:56:39.492231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'af4e101e-24ea-48e2-8434-e32bbee4efd9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc0375fe3c0>]}
[0m10:56:39.629022 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'af4e101e-24ea-48e2-8434-e32bbee4efd9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc0361404a0>]}
[0m10:56:39.629502 [info ] [MainThread]: Found 2 models, 1 test, 1 source, 459 macros
[0m10:56:39.629794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'af4e101e-24ea-48e2-8434-e32bbee4efd9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc036509910>]}
[0m10:56:39.631284 [info ] [MainThread]: 
[0m10:56:39.632054 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:56:39.634084 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_Stock_Watcher_analytics'
[0m10:56:39.654488 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher_analytics"
[0m10:56:39.655252 [debug] [ThreadPool]: On list_Stock_Watcher_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_dbt", "target_name": "dev", "connection_name": "list_Stock_Watcher_analytics"} */
show objects in Stock_Watcher.analytics limit 10000
[0m10:56:39.655916 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:56:40.941492 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.285 seconds
[0m10:56:40.943303 [debug] [ThreadPool]: On list_Stock_Watcher_analytics: Close
[0m10:56:41.244227 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'af4e101e-24ea-48e2-8434-e32bbee4efd9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc0362f0440>]}
[0m10:56:41.245309 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:56:41.246007 [info ] [MainThread]: 
[0m10:56:41.251792 [debug] [Thread-1 (]: Began running node test.stock_dbt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08
[0m10:56:41.252584 [info ] [Thread-1 (]: 1 of 1 START test not_null_foreign_stock_change_rate_conditions_METRIC ......... [RUN]
[0m10:56:41.253522 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_Stock_Watcher_analytics, now test.stock_dbt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08)
[0m10:56:41.254116 [debug] [Thread-1 (]: Began compiling node test.stock_dbt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08
[0m10:56:41.282308 [debug] [Thread-1 (]: Writing injected SQL for node "test.stock_dbt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08"
[0m10:56:41.288474 [debug] [Thread-1 (]: Began executing node test.stock_dbt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08
[0m10:56:41.313311 [debug] [Thread-1 (]: Writing runtime sql for node "test.stock_dbt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08"
[0m10:56:41.318788 [debug] [Thread-1 (]: Using snowflake connection "test.stock_dbt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08"
[0m10:56:41.319483 [debug] [Thread-1 (]: On test.stock_dbt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_dbt", "target_name": "dev", "node_id": "test.stock_dbt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select METRIC
from Stock_Watcher.analytics.foreign_stock_change_rate_conditions
where METRIC is null



      
    ) dbt_internal_test
[0m10:56:41.319995 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:56:42.191268 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.871 seconds
[0m10:56:42.202356 [debug] [Thread-1 (]: On test.stock_dbt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08: Close
[0m10:56:42.497147 [info ] [Thread-1 (]: 1 of 1 PASS not_null_foreign_stock_change_rate_conditions_METRIC ............... [[32mPASS[0m in 1.24s]
[0m10:56:42.498241 [debug] [Thread-1 (]: Finished running node test.stock_dbt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08
[0m10:56:42.501910 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:56:42.502480 [debug] [MainThread]: Connection 'test.stock_dbt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08' was properly closed.
[0m10:56:42.502907 [info ] [MainThread]: 
[0m10:56:42.503349 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 2.87 seconds (2.87s).
[0m10:56:42.504403 [debug] [MainThread]: Command end result
[0m10:56:42.532661 [info ] [MainThread]: 
[0m10:56:42.533255 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:56:42.533653 [info ] [MainThread]: 
[0m10:56:42.534046 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m10:56:42.535793 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 5.536131, "process_in_blocks": "111664", "process_kernel_time": 0.441634, "process_mem_max_rss": "131468", "process_out_blocks": "2840", "process_user_time": 3.65352}
[0m10:56:42.536269 [debug] [MainThread]: Command `dbt test` succeeded at 10:56:42.536179 after 5.54 seconds
[0m10:56:42.536557 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc03915cbf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc0361e7b00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc039460560>]}
[0m10:56:42.536909 [debug] [MainThread]: Flushing usage events
[0m10:56:46.674534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f15a6746000>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f15a51e52e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f15a4ee7380>]}


============================== 10:56:46.678015 | 54f47fef-466f-4c8e-9cec-b61659ea2467 ==============================
[0m10:56:46.678015 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:56:46.678893 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt', 'log_path': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:56:47.003573 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '54f47fef-466f-4c8e-9cec-b61659ea2467', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f15a490d640>]}
[0m10:56:47.062566 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '54f47fef-466f-4c8e-9cec-b61659ea2467', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f15a63ac380>]}
[0m10:56:47.063372 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m10:56:47.146495 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m10:56:47.259018 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:56:47.259475 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:56:47.303720 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '54f47fef-466f-4c8e-9cec-b61659ea2467', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f15a383d100>]}
[0m10:56:47.392875 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '54f47fef-466f-4c8e-9cec-b61659ea2467', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f15a32c5910>]}
[0m10:56:47.393325 [info ] [MainThread]: Found 2 models, 1 test, 1 source, 459 macros
[0m10:56:47.393653 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '54f47fef-466f-4c8e-9cec-b61659ea2467', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f15a3297380>]}
[0m10:56:47.395595 [info ] [MainThread]: 
[0m10:56:47.396156 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:56:47.397297 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_Stock_Watcher'
[0m10:56:47.415770 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher"
[0m10:56:47.416410 [debug] [ThreadPool]: On list_Stock_Watcher: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_dbt", "target_name": "dev", "connection_name": "list_Stock_Watcher"} */
show terse schemas in database Stock_Watcher
    limit 10000
[0m10:56:47.417080 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:56:48.369960 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.953 seconds
[0m10:56:48.371461 [debug] [ThreadPool]: On list_Stock_Watcher: Close
[0m10:56:48.660307 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_Stock_Watcher_analytics'
[0m10:56:48.669742 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher_analytics"
[0m10:56:48.670242 [debug] [ThreadPool]: On list_Stock_Watcher_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_dbt", "target_name": "dev", "connection_name": "list_Stock_Watcher_analytics"} */
show objects in Stock_Watcher.analytics limit 10000
[0m10:56:48.670973 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:56:49.546754 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.876 seconds
[0m10:56:49.548637 [debug] [ThreadPool]: On list_Stock_Watcher_analytics: Close
[0m10:56:49.869654 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '54f47fef-466f-4c8e-9cec-b61659ea2467', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f15a36a75c0>]}
[0m10:56:49.870728 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:56:49.871246 [info ] [MainThread]: 
[0m10:56:49.875508 [debug] [Thread-1 (]: Began running node model.stock_dbt.src_foreign_stock_change_rate_conditions
[0m10:56:49.876718 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_Stock_Watcher_analytics, now model.stock_dbt.src_foreign_stock_change_rate_conditions)
[0m10:56:49.877427 [debug] [Thread-1 (]: Began compiling node model.stock_dbt.src_foreign_stock_change_rate_conditions
[0m10:56:49.886297 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_dbt.src_foreign_stock_change_rate_conditions"
[0m10:56:49.888391 [debug] [Thread-1 (]: Finished running node model.stock_dbt.src_foreign_stock_change_rate_conditions
[0m10:56:49.889910 [debug] [Thread-1 (]: Began running node model.stock_dbt.foreign_stock_change_rate_conditions
[0m10:56:49.890455 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.foreign_stock_change_rate_conditions .... [RUN]
[0m10:56:49.891124 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.stock_dbt.src_foreign_stock_change_rate_conditions, now model.stock_dbt.foreign_stock_change_rate_conditions)
[0m10:56:49.891670 [debug] [Thread-1 (]: Began compiling node model.stock_dbt.foreign_stock_change_rate_conditions
[0m10:56:49.934045 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_dbt.foreign_stock_change_rate_conditions"
[0m10:56:49.938041 [debug] [Thread-1 (]: Began executing node model.stock_dbt.foreign_stock_change_rate_conditions
[0m10:56:49.969281 [debug] [Thread-1 (]: Writing runtime sql for node "model.stock_dbt.foreign_stock_change_rate_conditions"
[0m10:56:49.981222 [debug] [Thread-1 (]: Using snowflake connection "model.stock_dbt.foreign_stock_change_rate_conditions"
[0m10:56:49.981835 [debug] [Thread-1 (]: On model.stock_dbt.foreign_stock_change_rate_conditions: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_dbt", "target_name": "dev", "node_id": "model.stock_dbt.foreign_stock_change_rate_conditions"} */
create or replace transient table Stock_Watcher.analytics.foreign_stock_change_rate_conditions
         as
        (WITH  __dbt__cte__src_foreign_stock_change_rate_conditions as (
WITH src_foreign_stock_info_complete AS ( 
 SELECT * FROM Stock_Watcher.raw_data.foreign_stock_info_complete
)
SELECT NAME
     , FULLNAME 
     , DATE 
     , "Close" 
 FROM src_foreign_stock_info_complete
), ranked_data AS (
    SELECT *,
        ("Close" - LAG("Close") OVER (PARTITION BY name, fullname ORDER BY date)) / LAG("Close") OVER (PARTITION BY name, fullname ORDER BY date) * 100 AS change,
       -- 한 시간 변화율 계산
        (LEAD("Close", 1) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS hour_change,
        -- 하루 변화율 계산
        (LEAD("Close", 9) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS i_day_change_mean,
        
        -- 3일 변화율 계산
        (LEAD("Close", 27) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS three_day_change,
        
        -- 일주일 변화율 계산
        (LEAD("Close", 45) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS weekly_change
    FROM __dbt__cte__src_foreign_stock_change_rate_conditions
),
aggregated_data AS (
    SELECT
        CASE
            WHEN change > 10 THEN 'Change > 10'
            WHEN change > 5 THEN 'Change > 5'
            WHEN change <= -10 THEN 'Change <= -10'
            WHEN change <= -5 THEN 'Change <= -5'
            ELSE 'Other'
        END AS condition,
        AVG(hour_change) AS hour_change_mean,
        AVG(i_day_change_mean) AS i_day_change_mean,
        AVG(three_day_change) AS three_day_change_mean,
        AVG(weekly_change) AS weekly_change_mean,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY hour_change) AS hour_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY i_day_change_mean) AS i_day_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY three_day_change) AS three_day_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY weekly_change) AS weekly_change_median
    FROM ranked_data
    WHERE change > 5 OR change <= -5
    GROUP BY condition
)

-- mean값
SELECT 
    'hour_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN hour_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN hour_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN hour_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN hour_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'i_day_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN i_day_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN i_day_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN i_day_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN i_day_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'three_day_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN three_day_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN three_day_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN three_day_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN three_day_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'weekly_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN weekly_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN weekly_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN weekly_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN weekly_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

-- median값
UNION ALL

SELECT 
    'hour_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN hour_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN hour_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN hour_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN hour_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'i_day_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN i_day_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN i_day_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN i_day_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN i_day_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'three_day_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN three_day_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN three_day_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN three_day_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN three_day_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'weekly_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN weekly_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN weekly_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN weekly_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN weekly_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric
        );
[0m10:56:49.982286 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:56:52.646566 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.664 seconds
[0m10:56:52.674732 [debug] [Thread-1 (]: On model.stock_dbt.foreign_stock_change_rate_conditions: Close
[0m10:56:53.001526 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '54f47fef-466f-4c8e-9cec-b61659ea2467', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f15a5681790>]}
[0m10:56:53.002373 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.foreign_stock_change_rate_conditions  [[32mSUCCESS 1[0m in 3.11s]
[0m10:56:53.003162 [debug] [Thread-1 (]: Finished running node model.stock_dbt.foreign_stock_change_rate_conditions
[0m10:56:53.005093 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:56:53.005620 [debug] [MainThread]: Connection 'list_Stock_Watcher' was properly closed.
[0m10:56:53.005981 [debug] [MainThread]: Connection 'model.stock_dbt.foreign_stock_change_rate_conditions' was properly closed.
[0m10:56:53.006355 [info ] [MainThread]: 
[0m10:56:53.006737 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 5.61 seconds (5.61s).
[0m10:56:53.007560 [debug] [MainThread]: Command end result
[0m10:56:53.032954 [info ] [MainThread]: 
[0m10:56:53.033475 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:56:53.033825 [info ] [MainThread]: 
[0m10:56:53.034177 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m10:56:53.034908 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.401428, "process_in_blocks": "272", "process_kernel_time": 0.159471, "process_mem_max_rss": "125032", "process_out_blocks": "1976", "process_user_time": 2.292406}
[0m10:56:53.035339 [debug] [MainThread]: Command `dbt run` succeeded at 10:56:53.035252 after 6.40 seconds
[0m10:56:53.035624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f15a70f0a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f15a4ee7380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f15a3336e40>]}
[0m10:56:53.035890 [debug] [MainThread]: Flushing usage events
[0m10:57:45.335840 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9549ef5a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f954a951e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9549ef74d0>]}


============================== 10:57:45.340298 | dc266ce2-5256-43ba-ab68-46b2e69db2a7 ==============================
[0m10:57:45.340298 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:57:45.340814 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt/logs', 'version_check': 'True', 'profiles_dir': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:57:45.885846 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dc266ce2-5256-43ba-ab68-46b2e69db2a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9548cb67b0>]}
[0m10:57:45.940857 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dc266ce2-5256-43ba-ab68-46b2e69db2a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9548929760>]}
[0m10:57:45.942461 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m10:57:46.010654 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m10:57:46.173004 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:57:46.173476 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:57:46.211768 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dc266ce2-5256-43ba-ab68-46b2e69db2a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f95488a4140>]}
[0m10:57:46.344136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dc266ce2-5256-43ba-ab68-46b2e69db2a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9548373d10>]}
[0m10:57:46.344716 [info ] [MainThread]: Found 2 models, 1 test, 1 source, 459 macros
[0m10:57:46.345036 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dc266ce2-5256-43ba-ab68-46b2e69db2a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f95488c0b00>]}
[0m10:57:46.346609 [info ] [MainThread]: 
[0m10:57:46.347580 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:57:46.348922 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_Stock_Watcher_analytics'
[0m10:57:46.364500 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher_analytics"
[0m10:57:46.365253 [debug] [ThreadPool]: On list_Stock_Watcher_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_dbt", "target_name": "dev", "connection_name": "list_Stock_Watcher_analytics"} */
show objects in Stock_Watcher.analytics limit 10000
[0m10:57:46.365822 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:57:47.561287 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.195 seconds
[0m10:57:47.563493 [debug] [ThreadPool]: On list_Stock_Watcher_analytics: Close
[0m10:57:47.906232 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dc266ce2-5256-43ba-ab68-46b2e69db2a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f95483ef980>]}
[0m10:57:47.907843 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:57:47.908834 [info ] [MainThread]: 
[0m10:57:47.914006 [debug] [Thread-1 (]: Began running node test.stock_dbt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08
[0m10:57:47.914918 [info ] [Thread-1 (]: 1 of 1 START test not_null_foreign_stock_change_rate_conditions_METRIC ......... [RUN]
[0m10:57:47.916301 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_Stock_Watcher_analytics, now test.stock_dbt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08)
[0m10:57:47.917124 [debug] [Thread-1 (]: Began compiling node test.stock_dbt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08
[0m10:57:47.936029 [debug] [Thread-1 (]: Writing injected SQL for node "test.stock_dbt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08"
[0m10:57:47.936883 [debug] [Thread-1 (]: Began executing node test.stock_dbt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08
[0m10:57:47.958556 [debug] [Thread-1 (]: Writing runtime sql for node "test.stock_dbt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08"
[0m10:57:47.959417 [debug] [Thread-1 (]: Using snowflake connection "test.stock_dbt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08"
[0m10:57:47.959757 [debug] [Thread-1 (]: On test.stock_dbt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_dbt", "target_name": "dev", "node_id": "test.stock_dbt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select METRIC
from Stock_Watcher.analytics.foreign_stock_change_rate_conditions
where METRIC is null



      
    ) dbt_internal_test
[0m10:57:47.960019 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:57:49.063714 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.103 seconds
[0m10:57:49.072729 [debug] [Thread-1 (]: On test.stock_dbt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08: Close
[0m10:57:49.372486 [info ] [Thread-1 (]: 1 of 1 PASS not_null_foreign_stock_change_rate_conditions_METRIC ............... [[32mPASS[0m in 1.46s]
[0m10:57:49.373327 [debug] [Thread-1 (]: Finished running node test.stock_dbt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08
[0m10:57:49.375258 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:57:49.375585 [debug] [MainThread]: Connection 'test.stock_dbt.not_null_foreign_stock_change_rate_conditions_METRIC.6e13971a08' was properly closed.
[0m10:57:49.375799 [info ] [MainThread]: 
[0m10:57:49.376056 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 3.03 seconds (3.03s).
[0m10:57:49.376667 [debug] [MainThread]: Command end result
[0m10:57:49.402749 [info ] [MainThread]: 
[0m10:57:49.403253 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:57:49.403623 [info ] [MainThread]: 
[0m10:57:49.403940 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m10:57:49.407324 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 4.1262527, "process_in_blocks": "111696", "process_kernel_time": 0.301548, "process_mem_max_rss": "126140", "process_out_blocks": "1912", "process_user_time": 2.231461}
[0m10:57:49.407903 [debug] [MainThread]: Command `dbt test` succeeded at 10:57:49.407818 after 4.13 seconds
[0m10:57:49.408166 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f954b3f9340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f954aada240>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f954884b1a0>]}
[0m10:57:49.408422 [debug] [MainThread]: Flushing usage events
[0m10:57:54.402534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fade3abfbf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fade36198b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fade4e30b30>]}


============================== 10:57:54.405307 | 851b2d4f-437a-4637-af74-dcf234496bfa ==============================
[0m10:57:54.405307 [info ] [MainThread]: Running with dbt=1.8.9
[0m10:57:54.405868 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/home/woong/de4_week3/stock-watcher/airflow/stock_dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:57:54.764156 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '851b2d4f-437a-4637-af74-dcf234496bfa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fade13ec620>]}
[0m10:57:54.821993 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '851b2d4f-437a-4637-af74-dcf234496bfa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fade2629dc0>]}
[0m10:57:54.822769 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m10:57:54.888216 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m10:57:54.997438 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:57:54.997831 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:57:55.036227 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '851b2d4f-437a-4637-af74-dcf234496bfa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fade14d4710>]}
[0m10:57:55.125420 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '851b2d4f-437a-4637-af74-dcf234496bfa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fade11dc3e0>]}
[0m10:57:55.125878 [info ] [MainThread]: Found 2 models, 1 test, 1 source, 459 macros
[0m10:57:55.126203 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '851b2d4f-437a-4637-af74-dcf234496bfa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fade14b9700>]}
[0m10:57:55.128393 [info ] [MainThread]: 
[0m10:57:55.129189 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:57:55.130130 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_Stock_Watcher'
[0m10:57:55.147095 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher"
[0m10:57:55.147531 [debug] [ThreadPool]: On list_Stock_Watcher: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_dbt", "target_name": "dev", "connection_name": "list_Stock_Watcher"} */
show terse schemas in database Stock_Watcher
    limit 10000
[0m10:57:55.147770 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:57:56.019669 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.872 seconds
[0m10:57:56.021306 [debug] [ThreadPool]: On list_Stock_Watcher: Close
[0m10:57:56.319548 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_Stock_Watcher_analytics'
[0m10:57:56.330145 [debug] [ThreadPool]: Using snowflake connection "list_Stock_Watcher_analytics"
[0m10:57:56.331085 [debug] [ThreadPool]: On list_Stock_Watcher_analytics: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_dbt", "target_name": "dev", "connection_name": "list_Stock_Watcher_analytics"} */
show objects in Stock_Watcher.analytics limit 10000
[0m10:57:56.331841 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:57:57.154170 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.822 seconds
[0m10:57:57.156021 [debug] [ThreadPool]: On list_Stock_Watcher_analytics: Close
[0m10:57:57.444347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '851b2d4f-437a-4637-af74-dcf234496bfa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fade0734410>]}
[0m10:57:57.446049 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:57:57.447279 [info ] [MainThread]: 
[0m10:57:57.453456 [debug] [Thread-1 (]: Began running node model.stock_dbt.src_foreign_stock_change_rate_conditions
[0m10:57:57.454229 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_Stock_Watcher_analytics, now model.stock_dbt.src_foreign_stock_change_rate_conditions)
[0m10:57:57.454750 [debug] [Thread-1 (]: Began compiling node model.stock_dbt.src_foreign_stock_change_rate_conditions
[0m10:57:57.461857 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_dbt.src_foreign_stock_change_rate_conditions"
[0m10:57:57.462731 [debug] [Thread-1 (]: Finished running node model.stock_dbt.src_foreign_stock_change_rate_conditions
[0m10:57:57.463805 [debug] [Thread-1 (]: Began running node model.stock_dbt.foreign_stock_change_rate_conditions
[0m10:57:57.464213 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.foreign_stock_change_rate_conditions .... [RUN]
[0m10:57:57.464615 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.stock_dbt.src_foreign_stock_change_rate_conditions, now model.stock_dbt.foreign_stock_change_rate_conditions)
[0m10:57:57.464954 [debug] [Thread-1 (]: Began compiling node model.stock_dbt.foreign_stock_change_rate_conditions
[0m10:57:57.528278 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_dbt.foreign_stock_change_rate_conditions"
[0m10:57:57.528955 [debug] [Thread-1 (]: Began executing node model.stock_dbt.foreign_stock_change_rate_conditions
[0m10:57:57.559391 [debug] [Thread-1 (]: Writing runtime sql for node "model.stock_dbt.foreign_stock_change_rate_conditions"
[0m10:57:57.563621 [debug] [Thread-1 (]: Using snowflake connection "model.stock_dbt.foreign_stock_change_rate_conditions"
[0m10:57:57.564483 [debug] [Thread-1 (]: On model.stock_dbt.foreign_stock_change_rate_conditions: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "stock_dbt", "target_name": "dev", "node_id": "model.stock_dbt.foreign_stock_change_rate_conditions"} */
create or replace transient table Stock_Watcher.analytics.foreign_stock_change_rate_conditions
         as
        (WITH  __dbt__cte__src_foreign_stock_change_rate_conditions as (
WITH src_foreign_stock_info_complete AS ( 
 SELECT * FROM Stock_Watcher.raw_data.foreign_stock_info_complete
)
SELECT NAME
     , FULLNAME 
     , DATE 
     , "Close" 
 FROM src_foreign_stock_info_complete
), ranked_data AS (
    SELECT *,
        ("Close" - LAG("Close") OVER (PARTITION BY name, fullname ORDER BY date)) / LAG("Close") OVER (PARTITION BY name, fullname ORDER BY date) * 100 AS change,
       -- 한 시간 변화율 계산
        (LEAD("Close", 1) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS hour_change,
        -- 하루 변화율 계산
        (LEAD("Close", 9) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS i_day_change_mean,
        
        -- 3일 변화율 계산
        (LEAD("Close", 27) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS three_day_change,
        
        -- 일주일 변화율 계산
        (LEAD("Close", 45) OVER (PARTITION BY name, fullname ORDER BY date) - "Close") 
        / "Close" * 100 AS weekly_change
    FROM __dbt__cte__src_foreign_stock_change_rate_conditions
),
aggregated_data AS (
    SELECT
        CASE
            WHEN change > 10 THEN 'Change > 10'
            WHEN change > 5 THEN 'Change > 5'
            WHEN change <= -10 THEN 'Change <= -10'
            WHEN change <= -5 THEN 'Change <= -5'
            ELSE 'Other'
        END AS condition,
        AVG(hour_change) AS hour_change_mean,
        AVG(i_day_change_mean) AS i_day_change_mean,
        AVG(three_day_change) AS three_day_change_mean,
        AVG(weekly_change) AS weekly_change_mean,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY hour_change) AS hour_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY i_day_change_mean) AS i_day_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY three_day_change) AS three_day_change_median,
        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY weekly_change) AS weekly_change_median
    FROM ranked_data
    WHERE change > 5 OR change <= -5
    GROUP BY condition
)

-- mean값
SELECT 
    'hour_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN hour_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN hour_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN hour_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN hour_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'i_day_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN i_day_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN i_day_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN i_day_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN i_day_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'three_day_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN three_day_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN three_day_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN three_day_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN three_day_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'weekly_change_mean' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN weekly_change_mean ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN weekly_change_mean ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN weekly_change_mean ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN weekly_change_mean ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

-- median값
UNION ALL

SELECT 
    'hour_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN hour_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN hour_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN hour_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN hour_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'i_day_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN i_day_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN i_day_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN i_day_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN i_day_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'three_day_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN three_day_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN three_day_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN three_day_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN three_day_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric

UNION ALL

SELECT 
    'weekly_change_median' AS metric, 
    MAX(CASE WHEN condition = 'Change > 10' THEN weekly_change_median ELSE NULL END) AS "Change > 10",
    MAX(CASE WHEN condition = 'Change > 5' THEN weekly_change_median ELSE NULL END) AS "Change > 5",
    MAX(CASE WHEN condition = 'Change <= -10' THEN weekly_change_median ELSE NULL END) AS "Change <= -10",
    MAX(CASE WHEN condition = 'Change <= -5' THEN weekly_change_median ELSE NULL END) AS "Change <= -5"
FROM aggregated_data
GROUP BY metric
        );
[0m10:57:57.565438 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:57:59.551808 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.986 seconds
[0m10:57:59.581865 [debug] [Thread-1 (]: On model.stock_dbt.foreign_stock_change_rate_conditions: Close
[0m10:57:59.896645 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '851b2d4f-437a-4637-af74-dcf234496bfa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fade051f4d0>]}
[0m10:57:59.897700 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.foreign_stock_change_rate_conditions  [[32mSUCCESS 1[0m in 2.43s]
[0m10:57:59.898530 [debug] [Thread-1 (]: Finished running node model.stock_dbt.foreign_stock_change_rate_conditions
[0m10:57:59.900265 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:57:59.900638 [debug] [MainThread]: Connection 'list_Stock_Watcher' was properly closed.
[0m10:57:59.900850 [debug] [MainThread]: Connection 'model.stock_dbt.foreign_stock_change_rate_conditions' was properly closed.
[0m10:57:59.901074 [info ] [MainThread]: 
[0m10:57:59.901360 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.77 seconds (4.77s).
[0m10:57:59.901937 [debug] [MainThread]: Command end result
[0m10:57:59.930408 [info ] [MainThread]: 
[0m10:57:59.931345 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:57:59.932383 [info ] [MainThread]: 
[0m10:57:59.933197 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m10:57:59.934155 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.5804143, "process_in_blocks": "256", "process_kernel_time": 0.080135, "process_mem_max_rss": "125456", "process_out_blocks": "1984", "process_user_time": 2.323939}
[0m10:57:59.934642 [debug] [MainThread]: Command `dbt run` succeeded at 10:57:59.934549 after 5.58 seconds
[0m10:57:59.935031 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fade3565280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fade617b350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fade1570500>]}
[0m10:57:59.935375 [debug] [MainThread]: Flushing usage events
